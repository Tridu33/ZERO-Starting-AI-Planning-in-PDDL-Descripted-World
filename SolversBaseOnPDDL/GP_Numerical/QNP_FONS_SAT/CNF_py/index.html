<!DOCTYPE html><html> <head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width, initial-scale=1.0"><meta name=author content=tridu33><link rel="shortcut icon" href=../../../../img/favicon.ico><title>CNF_py &mdash; AI Planning in PDDL-Descripted World</title><link rel=stylesheet href="//fonts.googleapis.com/css?family=Lato:400,700"><link rel=stylesheet href=//cdn.jsdelivr.net/gh/tonsky/FiraCode@1.206/distr/fira_code.css><link rel=stylesheet href=//use.fontawesome.com/releases/v5.8.1/css/all.css><link rel=stylesheet href=//use.fontawesome.com/releases/v5.8.1/css/v4-shims.css><link rel=stylesheet href=../../../../css/theme.css><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css><script src=//code.jquery.com/jquery-2.1.1.min.js></script><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js></script><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js></script><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/python.min.js></script><script>
        hljs.initHighlightingOnLoad();
    </script></head> <body ontouchstart> <div id=container> <aside> <div class=home> <div class=title> <button class=hamburger></button> <a href=../../../.. class=site-name> AI Planning in PDDL-Descripted World</a> </div> <div class=search> <div role=search> <form id=rtd-search-form class=wy-form action=../../../../search.html method=get> <input type=text name=q placeholder="Search docs" title="Type search term here"> </form> </div> </div> </div> <nav class=nav> <ul class=root> <li class=toctree-l1><a class=nav-item href=../../../..>Home</a></li> <li class=toctree-l1><button class="section nav-item">规划界黑话</button> <ul class=subnav> <li class=toctree-l2><button class="section nav-item hide">PDDL进化史</button> <ul class="subnav hide"> <li class=toctree-l3><a href=../../../../PlanLanguages/PDDL%E8%AF%AD%E8%A8%80/ class=nav-item>HelloPDDL</a></li> <li class=toctree-l3><a href=../../../../PlanLanguages/PDDL_basic/ class=nav-item>PDDL-Basic</a></li> <li class=toctree-l3><a href=../../../../PlanLanguages/ADL/ class=nav-item>ADL</a></li> <li class=toctree-l3><a href=../../../../PlanLanguages/STRIPS%E8%AF%AD%E8%A8%80/ class=nav-item>STRIPS</a></li> <li class=toctree-l3><button class="section nav-item hide">PDDL</button> <ul class="subnav hide"> <li class=toctree-l4><a href=../../../../PlanLanguages/Extension%20to%20PDDL/ class=nav-item>PDDL扩展</a></li> <li class=toctree-l4><a href=../../../../PlanLanguages/FOND-QNP%28SAS%2B%29/ class=nav-item>FOND-QNP(SAS+)</a></li> </ul></li> </ul></li> <li class=toctree-l2><button class="section nav-item hide">机器人世界</button> <ul class="subnav hide"> <li class=toctree-l3><a href=../../../../PlanLanguages/Golog/Golog_ROS/ class=nav-item>Golog</a></li> </ul></li> </ul></li> <li class=toctree-l1><button class="section nav-item">PDDL使用</button> <ul class=subnav> <li class=toctree-l2> <a href=../../../../Usage/LocalSolvers/ class=nav-item>本地环境使用</a></li> <li class=toctree-l2> <a href=../../../../Usage/OnlineSolver/ class=nav-item>线上求解器使用</a></li> <li class=toctree-l2> <a href=../../../../Usage/VSCode/ class=nav-item>Visual Studio Code使用</a></li> <li class=toctree-l2><a href=../../../../Usage/FFPlanner_demo/ class=nav-item>ffPlanner_demo</a></li> <li class=toctree-l2><button class="section nav-item hide">经典demos</button> <ul class="subnav hide"> <li class=toctree-l3><a href=../../../%E5%88%8A%E7%89%A9%E4%B8%8A%E7%BB%8F%E5%85%B8demos/ class=nav-item>刊物上经典demos</a></li> <li class=toctree-l3><a href=../../../PDDL%20Benchmark%20Instances/ class=nav-item>BenchMark</a></li> </ul></li> </ul></li> <li class=toctree-l1><button class="section nav-item">PDDL语法</button> <ul class=subnav> <li class=toctree-l2> <a href=../../../../Syntax/PDDL%20axioms/ class=nav-item>语法总览</a></li> <li class=toctree-l2> <a href=../../../../Syntax/PDDLParser/ class=nav-item>Parser</a></li> </ul></li> <li class=toctree-l1><button class="section nav-item">PDDL-Descripted AI Planning World</button> <ul class=subnav> <li class=toctree-l2><button class="section nav-item hide">Papers</button> <ul class="subnav hide"> <li class=toctree-l3><a href=../../../../Papers/A%20review%20of%20generalized%20planning/ class=nav-item>reviewOfGP</a></li> <li class=toctree-l3><a href=../../../../Papers/GP_summary/ class=nav-item>GP_summary</a></li> <li class=toctree-l3><a href=../../../../Papers/A%20Review%20of%20Machine%20Learning%20for%20Automated%20Planning/ class=nav-item>ReviewOfMLforAP</a></li> <li class=toctree-l3><a href=../../../../Papers/Generalized%20Planning%20With%20Deep%20Reinforcement%20Learning/ class=nav-item>GPwithDeep-RL</a></li> <li class=toctree-l3><a href=../../../../Papers/Survey%20of%20research%20literature/ class=nav-item>researchSurvey</a></li> </ul></li> <li class="toctree-l2 current"><button class="section nav-item">SolversBaseOnPDDL</button> <ul class=subnav> <li class=toctree-l3><a href=../../../PyperPlan_STRIPS/ class=nav-item>PyperPlan_STRIPS</a></li> <li class=toctree-l3><a href=../../../Solvers/ class=nav-item>Solvers</a></li> <li class=toctree-l3><button class="section nav-item hide">CP</button> <ul class="subnav hide"> <li class=toctree-l4><a href=../../../CP/ffPlaner/ class=nav-item>FF</a></li> <li class=toctree-l4><a href=../../../CP/fast-downward/ class=nav-item>FD</a></li> <li class=toctree-l4><a href=../../../CP/LAPKT%E8%BD%BB%E9%87%8F%E8%87%AA%E5%8A%A8%E8%A7%84%E5%88%92%E5%B7%A5%E5%85%B7%E5%8C%85/ class=nav-item>LAPKT轻量自动规划工具包</a></li> </ul></li> <li class=toctree-l3><button class="section nav-item hide">GP_Numerical</button> <ul class="subnav hide"> <li class=toctree-l4> <a href=../../QNP_ReduceTo_GraphProblem/ class=nav-item>QNP_ReduceTo_GraphProblem</a></li> <li class=toctree-l4><a href=../../%E5%9B%BE%E6%B3%95QNP/ class=nav-item>图法QNP</a></li> <li class=toctree-l4><a href=../../LPG%EF%BC%88%E6%9C%AC%E5%9C%B0%E6%90%9C%E7%B4%A2%E8%A7%84%E5%88%92%E5%9B%BE%EF%BC%89/ class=nav-item>LPG</a></li> <li class=toctree-l4><a href=../../grahPlan/ class=nav-item>grahPlan</a></li> <li class=toctree-l4><a href=../../SGPlan6/ class=nav-item>SGPlan6</a></li> <li class=toctree-l4><a href=../../PRP/ class=nav-item>PRP</a></li> <li class=toctree-l4><a href=../../myND/ class=nav-item>myND</a></li> </ul></li> <li class="toctree-l3 current"><button class="section nav-item">QNP_FONS_SAT</button> <ul class=subnav> <li class="toctree-l4 current"><a href=./ class="nav-item current">CNF_py</a> <ul class=subnav> <li class=toctree-l5><a class="nav-item toc" href=#l3>L3</a></li> <li class=toctree-l5><a class="nav-item toc" href=#cnf>CNF</a></li> <li class=toctree-l5><a class="nav-item toc" href=#cnfpy>cnf.py</a></li> <li class=toctree-l5><a class="nav-item toc" href=#cnf_1>cnf源码加解析各自的类</a></li> <li class=toctree-l5><a class="nav-item toc" href=#general>GENERAl通用功能性函数</a></li> <li class=toctree-l5><a class="nav-item toc" href=#parseoutputpolicy>parseOutput输出解决policy</a></li> <li class=toctree-l5><a class="nav-item toc" href=#generate_clauses>generate_clauses核心入口类</a></li> <li class=toctree-l5><a class="nav-item toc" href=#generate_clauses_1>generate_clauses调用的生成子句的类</a></li> </ul></li> <li class=toctree-l4><a href=../FOND/ class=nav-item>FOND</a></li> <li class=toctree-l4><a href=../QA_FOND/ class=nav-item>QA_FOND</a></li> <li class=toctree-l4><a href=../%E4%BE%8B%E8%A7%A3FOND%2BCNF/ class=nav-item>例解FOND</a></li> <li class=toctree-l4><a href=../QNP/ class=nav-item>QNP</a></li> <li class=toctree-l4><a href=../qnp2fond/ class=nav-item>qnp2fond</a></li> <li class=toctree-l4><a href=../QNP2SAT/ class=nav-item>QNP2SAT</a></li> </ul></li> </ul></li> <li class=toctree-l2><button class="section nav-item hide">PDDL-plan-validators</button> <ul class="subnav hide"> <li class=toctree-l3><a href=../../../../Extensions/PDDL-plan-validator/PDDL-plan-validator/ class=nav-item>validators</a></li> <li class=toctree-l3><a href=../../../../Extensions/PDDL-plan-validator/Lisp-pddl-INVAL-validator/ class=nav-item>INVAL</a></li> <li class=toctree-l3><a href=../../../../Extensions/PDDL-plan-validator/VScode-PDDL%E6%8F%92%E4%BB%B6VAL/ class=nav-item>VAL</a></li> </ul></li> <li class=toctree-l2><button class="section nav-item hide">PDDL-Auto Planning</button> <ul class="subnav hide"> <li class=toctree-l3><a href=../../../../Extensions/AP/PDDL4j_Java%20for%E8%87%AA%E5%8A%A8%E8%A7%84%E5%88%92/ class=nav-item>PDDL4j</a></li> <li class=toctree-l3><a href=../../../../Extensions/AP/Tarski%20-%20An%20AI%20Planning%20Modeling%20Framework/ class=nav-item>Tarski</a></li> <li class=toctree-l3><a href=../../../../Extensions/AP/%E5%AE%9E%E4%BE%8B%E4%B8%AD%E5%AD%A6%E4%B9%A0QNP%E5%AE%9A%E4%B9%89%E5%AE%9E%E7%8E%B0AP%28AutomatedPlanning%29/ class=nav-item>QNP2AP</a></li> <li class=toctree-l3><a href=../../../../Extensions/RL/PDDLGYM/ class=nav-item>PDDLGYM</a></li> <li class=toctree-l3><a href=../../../../Extensions/RL/RLPlanPapers/ class=nav-item>PDDL+RL强化学习</a></li> </ul></li> </ul></li> <li class=toctree-l1><button class="section nav-item">进击的PDDL</button> <ul class=subnav> <li class=toctree-l2><button class="section nav-item hide">Curry-Howard correspondence</button> <ul class="subnav hide"> <li class=toctree-l3><a href=../../../../FurtherMore/%E6%8E%A7%E5%88%B6%E6%B5%81%E5%9B%BECFG%E8%AF%AD%E4%B9%89%E7%BD%91%E7%BB%9Cpetri%E8%BF%81%E7%A7%BB%E7%B3%BB%E7%BB%9F%E6%89%A9%E5%B1%95%E5%BA%94%E7%94%A8/ class=nav-item>CFG语义网络</a></li> <li class=toctree-l3><a href=../../../../FurtherMore/PDDL-Solver2AST/ class=nav-item>PDDL-Solver2AST</a></li> <li class=toctree-l3><a href=../../../../FurtherMore/TransitionSystemModelCheck/ class=nav-item>CFG=TransitionSystemModelCheck.md</a></li> <li class=toctree-l3><a href=../../../../FurtherMore/qnp2ast2program/ class=nav-item>qnp2ast2program</a></li> </ul></li> </ul></li> <li class=toctree-l1> <a class=nav-item href=https://github.com/Tridu33/ZERO-Starting-AI-Planning-in-PDDL-Descripted-World/issues>Issue跟踪讨论</a></li> </ul> </nav> <div class=repo> <div class=link> </div> <div class=previous><a href=../../myND/ >&laquo; Previous</a></div> <div class=next><a href=../FOND/ >Next &raquo;</a></div> </div> </aside> <div id=spacer><button class=arrow></button></div> <main> <div class=home-top> <button class=hamburger></button> <a href=../../../.. class=site-name> AI Planning in PDDL-Descripted World</a> </div> <div id=main> <nav class=breadcrumbs> <ul> <li>PDDL-Descripted AI Planning World &raquo; </li><li>SolversBaseOnPDDL &raquo; </li><li>QNP_FONS_SAT</li> </ul> </nav> <div id=content><div class=toc> <ul> <li><a href=#cnf_py>CNF_py</a><ul> <li><a href=#l3>L3</a></li> <li><a href=#cnf>CNF</a></li> <li><a href=#cnfpy>cnf.py</a></li> <li><a href=#cnf_1>cnf源码加解析各自的类</a></li> <li><a href=#general>GENERAl通用功能性函数</a></li> <li><a href=#parseoutputpolicy>parseOutput输出解决policy</a></li> <li><a href=#generate_clauses>generate_clauses核心入口类</a></li> <li><a href=#generate_clauses_1>generate_clauses调用的生成子句的类</a></li> </ul> </li> </ul> </div> <h1 id=cnf_py>CNF_py<a class=headerlink href=#cnf_py title="Permanent link">&para;</a></h1> <h2 id=l3>L3<a class=headerlink href=#l3 title="Permanent link">&para;</a></h2> <p>domain.pddl</p> <div class=highlight><pre><span></span><code>(define (problem line-0)
(:domain line)
(:objects 
    L1 - location
    L2 - location
    L3 - location
)
(:init
    (person-at L1)

    (road L1 L2)
    (road L2 L1)
    (road L3 L2)
    (road L2 L3)
)
(:goal (person-at L3))
)
</code></pre></div> <p>problem 3 grid move right</p> <div class=highlight><pre><span></span><code>; Stupid Examples for me to understand this programe 

(define (domain line)
  (:requirements :typing)
  (:types location)
  (:predicates (person-at ?loc - location)
               (road ?from - location ?to - location)
  )            
  (:action move-right
    :parameters (?from - location ?to - location)
    :precondition (and (person-at ?from) (road ?from ?to))
    :effect (and (person-at ?to) (not (person-at ?from)))
  )
)
</code></pre></div> <div class=highlight><pre><span></span><code>/src$ python  main.py ../mystupidroad/domain.pddl  ../mystupidroad/stupid.pddl -strong 1 -policy 1
</code></pre></div> <p>观察传入my_task的数据结构都有什么输入：</p> <div class=highlight><pre><span></span><code>p.generate_task(name_sas_file) #读取sas文件，保存数据
&gt;&gt;&gt; my_task = p.translate_to_atomic() #存进my_task类的实例对象my_task中，自动输出界面的内容
Setting atoms
# Atoms: 3
Setting initial
Setting goal
Setting actions
# Actions: 4
        Setting other actions
(0, &#39;/&#39;, 4)
        Setting action card
Setting mutexes
Setting relevant actions
Setting splitting
Setting compatible actions
(0, &#39;/&#39;, 4)
0.00387597084045
</code></pre></div> <p>查看my_task类中的局部变量</p> <div class=highlight><pre><span></span><code>class MyTask():
    def __init__(self):
        self.atoms = None # Set
        self.initial = None # Set of atoms
        self.goal = None # Set of atoms
        self.actions = None # Dictionary, name --&gt; [precs, adds, dels]
        self.action_nondet = {} # name --&gt; list other actions
        self.action_cardinality = {} # name --&gt; number
        self.mutex_groups = None # list of list; each sub-list has atoms belonging to the same mutex group
        self.compatible_actions = {} # action name --&gt; set of compatible actions
        self.mutex_groups_set = [] # list of sets of mutex groups
        self.relevant_actions_atom = {} # dictionary: atom --&gt; relevant actions
        self.relevant_actions_atom_aname = {} # dictionary: (atom, a_name) --&gt; relevant actions
        self.action_names = None # set
        self.other_actions_name = {} # Dictionary name --&gt; list of other actions
        self.action_name_to_actions = {} # action_name --&gt; list of actions
        ......
    def is_fair(self):
        for a in self.actions:
            if &#39;_unfair_&#39; in a:
                return False
        return True
        ......
</code></pre></div> <p>在Parser类的方法中翻译成，保存成mytask类的数据，可以根据myTask.py定义的方法</p> <div class=highlight><pre><span></span><code>    def print_task(self):
        print(&#39;ATOMS ================================================&#39;)
        for a in self.atoms:
            print(a)
        print(&#39;INITIAL ==============================================&#39;)
        for a in self.initial:
            print(a)
        print(&#39;GOAL =================================================&#39;)
        for a in self.goal:
            print(a)
        print(&#39;ACTIONS ==============================================&#39;)
        for a in self.actions:
            print(a, self.get_other_actions(a))
            print(a, self.actions[a])
</code></pre></div> <p>打印出来看</p> <div class=highlight><pre><span></span><code>&gt;&gt;&gt; my_task.print_task()
ATOMS ================================================
(var0=1)
(var0=2)
(var0=0)
INITIAL ==============================================
(var0=0)
GOAL =================================================
(var0=2)
ACTIONS ==============================================
(&#39;move-right(l2,l3)&#39;, [])
(&#39;move-right(l2,l3)&#39;, [[&#39;(var0=1)&#39;], [&#39;(var0=2)&#39;], [&#39;(var0=1)&#39;]])
(&#39;move-right(l2,l1)&#39;, [])
(&#39;move-right(l2,l1)&#39;, [[&#39;(var0=1)&#39;], [&#39;(var0=0)&#39;], [&#39;(var0=1)&#39;]])
(&#39;move-right(l1,l2)&#39;, [])
(&#39;move-right(l1,l2)&#39;, [[&#39;(var0=0)&#39;], [&#39;(var0=1)&#39;], [&#39;(var0=0)&#39;]])
(&#39;move-right(l3,l2)&#39;, [])
(&#39;move-right(l3,l2)&#39;, [[&#39;(var0=2)&#39;], [&#39;(var0=1)&#39;], [&#39;(var0=2)&#39;]])
</code></pre></div> <p><div class=highlight><pre><span></span><code>&gt;&gt;&gt; print(my_task.action_nondet)
{&#39;move-right(l1,l2)&#39;: [], &#39;move-right(l3,l2)&#39;: [], &#39;move-right(l2,l3)&#39;: [], &#39;move-right(l2,l1)&#39;: []}
&gt;&gt;&gt; print(my_task.action_cardinality)
{&#39;move-right(l1,l2)&#39;: 1, &#39;move-right(l3,l2)&#39;: 1, &#39;move-right&#39;: 1, &#39;move-right(l2,l3)&#39;: 1, &#39;move-right(l2,l1)&#39;: 1}
&gt;&gt;&gt; print(my_task.mutex_groups)
[[&#39;(var0=0)&#39;, &#39;(var0=1)&#39;, &#39;(var0=2)&#39;]]
&gt;&gt;&gt; print(my_task.compatible_actions)
{&#39;move-right(l1,l2)&#39;: set([]), &#39;move-right(l3,l2)&#39;: set([]), &#39;move-right(l2,l3)&#39;: set([&#39;move-right(l2,l1)&#39;]), &#39;move-right(l2,l1)&#39;: set([&#39;move-right(l2,l3)&#39;])}
&gt;&gt;&gt; print(my_task.mutex_groups_set)
[set([&#39;(var0=1)&#39;, &#39;(var0=2)&#39;, &#39;(var0=0)&#39;])]
&gt;&gt;&gt; print(my_task.relevant_actions_atom)
{&#39;(var0=1)&#39;: set([&#39;move-right(l1,l2)&#39;, &#39;move-right(l3,l2)&#39;, &#39;move-right(l2,l3)&#39;, &#39;move-right(l2,l1)&#39;]), &#39;(var0=2)&#39;: set([&#39;move-right(l2,l3)&#39;, &#39;move-right(l3,l2)&#39;]), &#39;(var0=0)&#39;: set([&#39;move-right(l1,l2)&#39;, &#39;move-right(l2,l1)&#39;])}
&gt;&gt;&gt; print(my_task.relevant_actions_atom_aname)
{}
&gt;&gt;&gt; print(my_task.action_names)
set([&#39;move-right&#39;])
&gt;&gt;&gt; print(my_task.other_actions_name)
{&#39;move-right&#39;: []}
&gt;&gt;&gt; print(my_task.action_name_to_actions)
{&#39;move-right&#39;: [&#39;move-right(l2,l3)&#39;, &#39;move-right(l2,l1)&#39;, &#39;move-right(l1,l2)&#39;, &#39;move-right(l3,l2)&#39;]}
</code></pre></div> parser.py中p.translate_to_atomic函数就是生成上述my_task数据结构对象的元凶</p> <div class=highlight><pre><span></span><code>    task = MyTask()
    debug = False#这个应该是开发的时候方便调试可以设置True
    print(&#39;Setting atoms&#39;)#原子命题
    task.set_atoms(self.get_atoms(), debug)
    print(&#39;Setting initial&#39;)#初态
    task.set_initial(self.get_initial_atomic(), debug)
    print(&#39;Setting goal&#39;)#终态
    task.set_goal(self.get_goal_atomic(), debug)
    print(&#39;Setting actions&#39;)#设定动作
    task.set_actions_atomic(self.get_actions_atomic(), debug)
    print(&#39;Setting mutexes&#39;)#设定互斥量？
    task.set_mutex_groups(self.get_mutex_groups_atomic(), debug)
    print(&#39;Setting relevant actions&#39;)#设置相关动作
    task.set_relevant_actions(debug)
    print(&#39;Setting splitting&#39;)#分裂
    task.initialize_splitting(debug)
    start = timer()
    print(&#39;Setting compatible actions&#39;)#设置相容可以并存的动作
    task.create_compatible_actions(debug)
    print(timer() - start)
    return task
</code></pre></div> <p>然后就是main.py大循环就是高潮部分：留意重点：</p> <div class=highlight><pre><span></span><code>solver_time = []
for i in range(1000):
    cnf = CNF(name_formula_file, name_formula_file_extra, fair, strong)#文件formula-temp.txt这时候是空白的，formula-extra-temp此时空白，仅仅是传入地址方便最终结果存入数据
    ......
    cnf.reset()
    start_g = timer()
    cnf.generate_clauses(my_task, &#39;n0&#39;, &#39;ng&#39;, controllerStates, len(controllerStates), p, show_gen_info)#生成子句Clauses和写入cnf文件合取范式的核心代码!!!
传入字符&#39;n0&#39;, 终态&#39;ng&#39;
&gt;&gt;&gt; print(controllerStates)
[&#39;n0&#39;, &#39;n1&#39;, &#39;ng&#39;]这个是3格的情况，2格的时候是[&#39;n0&#39;,&#39;ng&#39;]
&gt;&gt;&gt; len(controllerStates)
3
&gt;&gt;&gt; print(show_gen_info)
False懒得显示这部分，因为和我要关心的重点没关系
这里的p是Parser实例，可能用里面的方法，因为基本看着都是私有变量
    ......
    command = &#39;./minisat %s %s&#39; % (name_formula_file, name_output_satsolver)#调用minisat
    ......
    result = cnf.parseOutput(name_output_satsolver, controllerStates, p, print_policy)#读取文件name_output_satsolver : outsat-temp.txt输出结果
    ......
</code></pre></div> <h2 id=cnf>CNF<a class=headerlink href=#cnf title="Permanent link">&para;</a></h2> <p>重要的是再来一遍，main.py大循环就是高潮部分：留意重点：</p> <div class=highlight><pre><span></span><code>solver_time = []
for i in range(1000):
    cnf = CNF(name_formula_file, name_formula_file_extra, fair, strong)#文件formula-temp.txt这时候是空白的，formula-extra-temp此时空白，仅仅是传入地址方便最终结果存入数据
    ......
    cnf.reset()
    start_g = timer()
    #唯一重点，一行代码
    cnf.generate_clauses(my_task, &#39;n0&#39;, &#39;ng&#39;, controllerStates, len(controllerStates), p, show_gen_info)
    #生成子句Clauses和写入cnf文件合取范式的核心代码!!!
    ......
    command = &#39;./minisat %s %s&#39; % (name_formula_file, name_output_satsolver)#调用minisat
    ......
    result = cnf.parseOutput(name_output_satsolver, controllerStates, p, print_policy)#读取文件name_output_satsolver : outsat-temp.txt输出结果
    ......
</code></pre></div> <p>运行结果是<code>&gt;&gt;&gt; print(result) True</code></p> <p>然后是cnf对象的数据结构和变量，函数，类和方法</p> <div class=highlight><pre><span></span><code>class CNF:
    type1 = &#39;Atom-Controller&#39;
    type2 = &#39;Action-Controller&#39;
    type3 = &#39;Triplet&#39;
    type4 = &#39;Reachable-I&#39;
    type5 = &#39;Reachable-G&#39;
    type6 = &#39;Replacement-Goal&#39;
    type7 = &#39;Controller-Controller&#39;
    type8 = &#39;Replacement-Equality&#39;
    type9 = &#39;Inequality-CSCS&#39;
    type10 = &#39;Replacement-Goal&#39;
    num_types = 18#这些静态变量定义完了
    print_types = [1, 2, 3, 7]#？代表参数选项，想打印出来什么结果吗

    def __init__(self, n_file, n_file_extra, fair, strong):
        self.disjunctions = [] # list of disjunctions
        self.maxKey = 1
        self.mapVariableNumber = {}
        self.mapNumberVariable = {}
        self.mapVariableType = {}
        self.clauseSizeCounter = {}
        self.name_file_formula = n_file
        self.name_file_formula_extra = n_file_extra
        self.file_formula = open(n_file, &#39;w&#39;)
        self.file_formula_extra = open(n_file_extra, &#39;w&#39;)
        self.file_formula.close()
        self.file_formula_extra.close()
        self.number_clauses = 0
        self.fair   = fair
        self.strong = strong

    def reset(self):
        self.disjunctions = [] # list of disjunctions
        self.maxKey = 1
        self.mapVariableNumber = {}
        self.mapNumberVariable = {}
        self.mapVariableType = {}
        self.clauseSizeCounter = {}
        self.file_formula = open(self.name_file_formula, &#39;w&#39;)
        self.file_formula.write(&#39;p cnf 1 1\n&#39;)
        self.file_formula_extra = open(self.name_file_formula_extra, &#39;a&#39;)
        # File formula extra is not used, can be ignored
        self.number_clauses = 0
    ......
</code></pre></div> <p>然后看看运行完结果，其实加断点可以看第一次循环的结果，</p> <p>结果就是第二遍循环之后的这些量是多少：</p> <div class=highlight><pre><span></span><code>&gt;&gt;&gt; print(cnf.disjunctions)
[]
&gt;&gt;&gt; print(cnf.maxKey)
67
&gt;&gt;&gt; print(cnf.mapVariableNumber)
{&#39;reachableG(ng,0)&#39;: 49, &#39;(var0=2)(ng)&#39;: 3, &#39;YR1-n1-ng-1&#39;: 66, &#39;(n1,move-right(l1,l2))&#39;: 12, &#39;reachableG(ng,1)&#39;: 50, &#39;(ng,move-right,n0)&#39;: 31, &#39;(n1,move-right,ng)&#39;: 30, &#39;(ng,move-right(l1,l2))&#39;: 19, &#39;YR1-n0-n0-0&#39;: 55, &#39;(n1,move-right,n1)&#39;: 29, &#39;(ng,ng)&#39;: 42, &#39;reachableG(n1,1)&#39;: 54, &#39;(n0,move-right)&#39;: 22, &#39;(n0,move-right(l2,l3))&#39;: 4, &#39;(var0=1)(n1)&#39;: 10, &#39;(ng,move-right(l2,l1))&#39;: 18, &#39;YR1-n0-n0-1&#39;: 61, &#39;(ng,move-right(l2,l3))&#39;: 16, &#39;(n1,move-right,n0)&#39;: 28, &#39;YR1-n1-n0-0&#39;: 58, &#39;(n0,move-right,n1)&#39;: 26, &#39;(n1,move-right(l3,l2))&#39;: 14, &#39;reachableI(ng)&#39;: 45, &#39;(n1,n1)&#39;: 38, &#39;(n1,ng)&#39;: 39, &#39;(var0=0)(n1)&#39;: 13, &#39;(ng,move-right(l3,l2))&#39;: 21, &#39;YR1-n1-n1-1&#39;: 65, &#39;reachableI(n0)&#39;: 43, &#39;(var0=2)(n1)&#39;: 15, &#39;(var0=0)(n0)&#39;: 7, &#39;(ng,move-right)&#39;: 24, &#39;(n0,n0)&#39;: 34, &#39;(n0,move-right,ng)&#39;: 27, &#39;YR1-n1-n0-1&#39;: 64, &#39;YR1-n0-ng-0&#39;: 57, &#39;reachableG(n1,0)&#39;: 52, &#39;YR1-n1-n1-0&#39;: 59, &#39;(n1,n0)&#39;: 37, &#39;(var0=0)(ng)&#39;: 20, &#39;YR1-n0-ng-1&#39;: 63, &#39;(ng,move-right,n1)&#39;: 32, &#39;reachableI(n1)&#39;: 44, &#39;(ng,n1)&#39;: 41, &#39;reachableG(n1,2)&#39;: 47, &#39;YR1-n0-n1-1&#39;: 62, &#39;(var0=1)(n0)&#39;: 1, &#39;(n0,move-right(l2,l1))&#39;: 5, &#39;(n1,move-right(l2,l1))&#39;: 11, &#39;(n0,ng)&#39;: 36, &#39;(n0,move-right,n0)&#39;: 25, &#39;(ng,n0)&#39;: 40, &#39;YR1-n1-ng-0&#39;: 60, &#39;reachableG(n0,0)&#39;: 51, &#39;(var0=1)(ng)&#39;: 17, &#39;(n0,move-right(l1,l2))&#39;: 6, &#39;(n1,move-right)&#39;: 23, &#39;reachableG(n0,2)&#39;: 46, &#39;(n0,move-right(l3,l2))&#39;: 8, &#39;reachableG(n0,1)&#39;: 53, &#39;YR1-n0-n1-0&#39;: 56, &#39;(n1,move-right(l2,l3))&#39;: 9, &#39;(ng,move-right,ng)&#39;: 33, &#39;reachableG(ng,2)&#39;: 48, &#39;(var0=2)(n0)&#39;: 2, &#39;(n0,n1)&#39;: 35}
&gt;&gt;&gt; print(cnf.mapNumberVariable)
{1: &#39;(var0=1)(n0)&#39;, 2: &#39;(var0=2)(n0)&#39;, 3: &#39;(var0=2)(ng)&#39;, 4: &#39;(n0,move-right(l2,l3))&#39;, 5: &#39;(n0,move-right(l2,l1))&#39;, 6: &#39;(n0,move-right(l1,l2))&#39;, 7: &#39;(var0=0)(n0)&#39;, 8: &#39;(n0,move-right(l3,l2))&#39;, 9: &#39;(n1,move-right(l2,l3))&#39;, 10: &#39;(var0=1)(n1)&#39;, 11: &#39;(n1,move-right(l2,l1))&#39;, 12: &#39;(n1,move-right(l1,l2))&#39;, 13: &#39;(var0=0)(n1)&#39;, 14: &#39;(n1,move-right(l3,l2))&#39;, 15: &#39;(var0=2)(n1)&#39;, 16: &#39;(ng,move-right(l2,l3))&#39;, 17: &#39;(var0=1)(ng)&#39;, 18: &#39;(ng,move-right(l2,l1))&#39;, 19: &#39;(ng,move-right(l1,l2))&#39;, 20: &#39;(var0=0)(ng)&#39;, 21: &#39;(ng,move-right(l3,l2))&#39;, 22: &#39;(n0,move-right)&#39;, 23: &#39;(n1,move-right)&#39;, 24: &#39;(ng,move-right)&#39;, 25: &#39;(n0,move-right,n0)&#39;, 26: &#39;(n0,move-right,n1)&#39;, 27: &#39;(n0,move-right,ng)&#39;, 28: &#39;(n1,move-right,n0)&#39;, 29: &#39;(n1,move-right,n1)&#39;, 30: &#39;(n1,move-right,ng)&#39;, 31: &#39;(ng,move-right,n0)&#39;, 32: &#39;(ng,move-right,n1)&#39;, 33: &#39;(ng,move-right,ng)&#39;, 34: &#39;(n0,n0)&#39;, 35: &#39;(n0,n1)&#39;, 36: &#39;(n0,ng)&#39;, 37: &#39;(n1,n0)&#39;, 38: &#39;(n1,n1)&#39;, 39: &#39;(n1,ng)&#39;, 40: &#39;(ng,n0)&#39;, 41: &#39;(ng,n1)&#39;, 42: &#39;(ng,ng)&#39;, 43: &#39;reachableI(n0)&#39;, 44: &#39;reachableI(n1)&#39;, 45: &#39;reachableI(ng)&#39;, 46: &#39;reachableG(n0,2)&#39;, 47: &#39;reachableG(n1,2)&#39;, 48: &#39;reachableG(ng,2)&#39;, 49: &#39;reachableG(ng,0)&#39;, 50: &#39;reachableG(ng,1)&#39;, 51: &#39;reachableG(n0,0)&#39;, 52: &#39;reachableG(n1,0)&#39;, 53: &#39;reachableG(n0,1)&#39;, 54: &#39;reachableG(n1,1)&#39;, 55: &#39;YR1-n0-n0-0&#39;, 56: &#39;YR1-n0-n1-0&#39;, 57: &#39;YR1-n0-ng-0&#39;, 58: &#39;YR1-n1-n0-0&#39;, 59: &#39;YR1-n1-n1-0&#39;, 60: &#39;YR1-n1-ng-0&#39;, 61: &#39;YR1-n0-n0-1&#39;, 62: &#39;YR1-n0-n1-1&#39;, 63: &#39;YR1-n0-ng-1&#39;, 64: &#39;YR1-n1-n0-1&#39;, 65: &#39;YR1-n1-n1-1&#39;, 66: &#39;YR1-n1-ng-1&#39;}
&gt;&gt;&gt; print(cnf.mapVariableType)
{&#39;reachableG(ng,0)&#39;: 5, &#39;(var0=2)(ng)&#39;: 1, &#39;YR1-n1-ng-1&#39;: 6, &#39;(n1,move-right(l1,l2))&#39;: 2, &#39;reachableG(ng,1)&#39;: 5, &#39;(ng,move-right,n0)&#39;: 3, &#39;(n1,move-right,ng)&#39;: 3, &#39;(ng,move-right(l1,l2))&#39;: 2, &#39;YR1-n0-n0-0&#39;: 6, &#39;(n1,move-right,n1)&#39;: 3, &#39;(ng,ng)&#39;: 7, &#39;reachableG(n1,1)&#39;: 5, &#39;(n0,move-right)&#39;: 2, &#39;(n0,move-right(l2,l3))&#39;: 2, &#39;(var0=1)(n1)&#39;: 1, &#39;(ng,move-right(l2,l1))&#39;: 2, &#39;YR1-n0-n0-1&#39;: 6, &#39;(ng,move-right(l2,l3))&#39;: 2, &#39;(n1,move-right,n0)&#39;: 3, &#39;YR1-n1-n0-0&#39;: 6, &#39;(n0,move-right,n1)&#39;: 3, &#39;(n1,move-right(l3,l2))&#39;: 2, &#39;reachableI(ng)&#39;: 4, &#39;(n1,n1)&#39;: 7, &#39;(n1,ng)&#39;: 7, &#39;(var0=0)(n1)&#39;: 1, &#39;(ng,move-right(l3,l2))&#39;: 2, &#39;YR1-n1-n1-1&#39;: 6, &#39;reachableI(n0)&#39;: 4, &#39;(var0=2)(n1)&#39;: 1, &#39;(var0=0)(n0)&#39;: 1, &#39;(ng,move-right)&#39;: 2, &#39;(n0,n0)&#39;: 7, &#39;(n0,move-right,ng)&#39;: 3, &#39;YR1-n1-n0-1&#39;: 6, &#39;YR1-n0-ng-0&#39;: 6, &#39;reachableG(n1,0)&#39;: 5, &#39;YR1-n1-n1-0&#39;: 6, &#39;(n1,n0)&#39;: 7, &#39;(var0=0)(ng)&#39;: 1, &#39;YR1-n0-ng-1&#39;: 6, &#39;(ng,move-right,n1)&#39;: 3, &#39;reachableI(n1)&#39;: 4, &#39;(ng,n1)&#39;: 7, &#39;reachableG(n1,2)&#39;: 5, &#39;YR1-n0-n1-1&#39;: 6, &#39;(var0=1)(n0)&#39;: 1, &#39;(n0,move-right(l2,l1))&#39;: 2, &#39;(n1,move-right(l2,l1))&#39;: 2, &#39;(n0,ng)&#39;: 7, &#39;(n0,move-right,n0)&#39;: 3, &#39;(ng,n0)&#39;: 7, &#39;YR1-n1-ng-0&#39;: 6, &#39;reachableG(n0,0)&#39;: 5, &#39;(var0=1)(ng)&#39;: 1, &#39;(n0,move-right(l1,l2))&#39;: 2, &#39;(n1,move-right)&#39;: 2, &#39;reachableG(n0,2)&#39;: 5, &#39;(n0,move-right(l3,l2))&#39;: 2, &#39;reachableG(n0,1)&#39;: 5, &#39;YR1-n0-n1-0&#39;: 6, &#39;(n1,move-right(l2,l3))&#39;: 2, &#39;(ng,move-right,ng)&#39;: 3, &#39;reachableG(ng,2)&#39;: 5, &#39;(var0=2)(n0)&#39;: 1, &#39;(n0,n1)&#39;: 7}
&gt;&gt;&gt; print(cnf.clauseSizeCounter)
{}
&gt;&gt;&gt; print(cnf.name_file_formula)
formula-temp.txt
&gt;&gt;&gt; print(cnf.name_file_formula_extra)
formula-extra-temp.txt
&gt;&gt;&gt; print(cnf.number_clauses)
234
&gt;&gt;&gt; print(cnf.fair)
True
&gt;&gt;&gt; print(cnf.strong)
True
</code></pre></div> <p>上面这个数据整理一下格式：</p> <div class=highlight><pre><span></span><code>&gt;&gt;&gt; print(cnf.mapVariableNumber)
{&#39;reachableG(ng,0)&#39;: 49,
 &#39;(var0=2)(ng)&#39;: 3,
 &#39;YR1-n1-ng-1&#39;: 66,
 &#39;(n1,move-right(l1,l2))&#39;: 12,
 &#39;reachableG(ng,1)&#39;: 50,
 &#39;(ng,move-right,n0)&#39;: 31,
 &#39;(n1,move-right,ng)&#39;: 30,
 &#39;(ng,move-right(l1,l2))&#39;: 19,
 &#39;YR1-n0-n0-0&#39;: 55,
 &#39;(n1,move-right,n1)&#39;: 29,
 &#39;(ng,ng)&#39;: 42,
 &#39;reachableG(n1,1)&#39;: 54,
 &#39;(n0,move-right)&#39;: 22,
 &#39;(n0,move-right(l2,l3))&#39;: 4,
 &#39;(var0=1)(n1)&#39;: 10,
 &#39;(ng,move-right(l2,l1))&#39;: 18,
 &#39;YR1-n0-n0-1&#39;: 61,
 &#39;(ng,move-right(l2,l3))&#39;: 16,
 &#39;(n1,move-right,n0)&#39;: 28,
 &#39;YR1-n1-n0-0&#39;: 58,
 &#39;(n0,move-right,n1)&#39;: 26,
 &#39;(n1,move-right(l3,l2))&#39;: 14,
 &#39;reachableI(ng)&#39;: 45,
 &#39;(n1,n1)&#39;: 38,
 &#39;(n1,ng)&#39;: 39,
 &#39;(var0=0)(n1)&#39;: 13,
 &#39;(ng,move-right(l3,l2))&#39;: 21,
 &#39;YR1-n1-n1-1&#39;: 65,
 &#39;reachableI(n0)&#39;: 43,
 &#39;(var0=2)(n1)&#39;: 15,
 &#39;(var0=0)(n0)&#39;: 7,
 &#39;(ng,move-right)&#39;: 24,
 &#39;(n0,n0)&#39;: 34,
 &#39;(n0,move-right,ng)&#39;: 27,
 &#39;YR1-n1-n0-1&#39;: 64,
 &#39;YR1-n0-ng-0&#39;: 57,
 &#39;reachableG(n1,0)&#39;: 52,
 &#39;YR1-n1-n1-0&#39;: 59,
 &#39;(n1,n0)&#39;: 37,
 &#39;(var0=0)(ng)&#39;: 20,
 &#39;YR1-n0-ng-1&#39;: 63,
 &#39;(ng,move-right,n1)&#39;: 32,
 &#39;reachableI(n1)&#39;: 44,
 &#39;(ng,n1)&#39;: 41,
 &#39;reachableG(n1,2)&#39;: 47,
 &#39;YR1-n0-n1-1&#39;: 62,
 &#39;(var0=1)(n0)&#39;: 1,
 &#39;(n0,move-right(l2,l1))&#39;: 5,
 &#39;(n1,move-right(l2,l1))&#39;: 11,
 &#39;(n0,ng)&#39;: 36,
 &#39;(n0,move-right,n0)&#39;: 25,
 &#39;(ng,n0)&#39;: 40,
 &#39;YR1-n1-ng-0&#39;: 60,
 &#39;reachableG(n0,0)&#39;: 51,
 &#39;(var0=1)(ng)&#39;: 17,
 &#39;(n0,move-right(l1,l2))&#39;: 6,
 &#39;(n1,move-right)&#39;: 23,
 &#39;reachableG(n0,2)&#39;: 46,
 &#39;(n0,move-right(l3,l2))&#39;: 8,
 &#39;reachableG(n0,1)&#39;: 53,
 &#39;YR1-n0-n1-0&#39;: 56,
 &#39;(n1,move-right(l2,l3))&#39;: 9,
 &#39;(ng,move-right,ng)&#39;: 33,
 &#39;reachableG(ng,2)&#39;: 48,
 &#39;(var0=2)(n0)&#39;: 2,
 &#39;(n0,n1)&#39;: 35}


&gt;&gt;&gt; print(cnf.mapNumberVariable)
{
1: &#39;(var0=1)(n0)&#39;, 
2: &#39;(var0=2)(n0)&#39;, 
3: &#39;(var0=2)(ng)&#39;, 
4: &#39;(n0,move-right(l2,l3))&#39;, 
5: &#39;(n0,move-right(l2,l1))&#39;, 
6: &#39;(n0,move-right(l1,l2))&#39;, 
7: &#39;(var0=0)(n0)&#39;, 
8: &#39;(n0,move-right(l3,l2))&#39;, 
9: &#39;(n1,move-right(l2,l3))&#39;, 
10: &#39;(var0=1)(n1)&#39;, 
11: &#39;(n1,move-right(l2,l1))&#39;, 
12: &#39;(n1,move-right(l1,l2))&#39;, 
13: &#39;(var0=0)(n1)&#39;, 
14: &#39;(n1,move-right(l3,l2))&#39;, 
15: &#39;(var0=2)(n1)&#39;, 
16: &#39;(ng,move-right(l2,l3))&#39;, 
17: &#39;(var0=1)(ng)&#39;, 
18: &#39;(ng,move-right(l2,l1))&#39;, 
19: &#39;(ng,move-right(l1,l2))&#39;, 
20: &#39;(var0=0)(ng)&#39;, 
21: &#39;(ng,move-right(l3,l2))&#39;, 
22: &#39;(n0,move-right)&#39;, 
23: &#39;(n1,move-right)&#39;, 
24: &#39;(ng,move-right)&#39;, 
25: &#39;(n0,move-right,n0)&#39;, 
26: &#39;(n0,move-right,n1)&#39;, 
27: &#39;(n0,move-right,ng)&#39;, 
28: &#39;(n1,move-right,n0)&#39;, 
29: &#39;(n1,move-right,n1)&#39;, 
30: &#39;(n1,move-right,ng)&#39;, 
31: &#39;(ng,move-right,n0)&#39;, 
32: &#39;(ng,move-right,n1)&#39;, 
33: &#39;(ng,move-right,ng)&#39;, 
34: &#39;(n0,n0)&#39;, 
35: &#39;(n0,n1)&#39;, 
36: &#39;(n0,ng)&#39;, 
37: &#39;(n1,n0)&#39;, 
38: &#39;(n1,n1)&#39;, 
39: &#39;(n1,ng)&#39;, 
40: &#39;(ng,n0)&#39;, 
41: &#39;(ng,n1)&#39;, 
42: &#39;(ng,ng)&#39;, 
43: &#39;reachableI(n0)&#39;, 
44: &#39;reachableI(n1)&#39;, 
45: &#39;reachableI(ng)&#39;, 
46: &#39;reachableG(n0,2)&#39;, 
47: &#39;reachableG(n1,2)&#39;, 
48: &#39;reachableG(ng,2)&#39;, 
49: &#39;reachableG(ng,0)&#39;, 
50: &#39;reachableG(ng,1)&#39;, 
51: &#39;reachableG(n0,0)&#39;, 
52: &#39;reachableG(n1,0)&#39;, 
53: &#39;reachableG(n0,1)&#39;, 
54: &#39;reachableG(n1,1)&#39;, 
55: &#39;YR1-n0-n0-0&#39;, 
56: &#39;YR1-n0-n1-0&#39;, 
57: &#39;YR1-n0-ng-0&#39;, 
58: &#39;YR1-n1-n0-0&#39;, 
59: &#39;YR1-n1-n1-0&#39;, 
60: &#39;YR1-n1-ng-0&#39;, 
61: &#39;YR1-n0-n0-1&#39;, 
62: &#39;YR1-n0-n1-1&#39;, 
63: &#39;YR1-n0-ng-1&#39;, 
64: &#39;YR1-n1-n0-1&#39;, 
65: &#39;YR1-n1-n1-1&#39;, 
66: &#39;YR1-n1-ng-1&#39;}


&gt;&gt;&gt; print(cnf.mapVariableType)
{&#39;reachableG(ng,0)&#39;: 5,
 &#39;(var0=2)(ng)&#39;: 1,
 &#39;YR1-n1-ng-1&#39;: 6,
 &#39;(n1,move-right(l1,l2))&#39;: 2,
 &#39;reachableG(ng,1)&#39;: 5,
 &#39;(ng,move-right,n0)&#39;: 3,
 &#39;(n1,move-right,ng)&#39;: 3,
 &#39;(ng,move-right(l1,l2))&#39;: 2,
 &#39;YR1-n0-n0-0&#39;: 6,
 &#39;(n1,move-right,n1)&#39;: 3,
 &#39;(ng,ng)&#39;: 7,
 &#39;reachableG(n1,1)&#39;: 5,
 &#39;(n0,move-right)&#39;: 2,
 &#39;(n0,move-right(l2,l3))&#39;: 2,
 &#39;(var0=1)(n1)&#39;: 1,
 &#39;(ng,move-right(l2,l1))&#39;: 2,
 &#39;YR1-n0-n0-1&#39;: 6,
 &#39;(ng,move-right(l2,l3))&#39;: 2,
 &#39;(n1,move-right,n0)&#39;: 3,
 &#39;YR1-n1-n0-0&#39;: 6,
 &#39;(n0,move-right,n1)&#39;: 3,
 &#39;(n1,move-right(l3,l2))&#39;: 2,
 &#39;reachableI(ng)&#39;: 4,
 &#39;(n1,n1)&#39;: 7,
 &#39;(n1,ng)&#39;: 7,
 &#39;(var0=0)(n1)&#39;: 1,
 &#39;(ng,move-right(l3,l2))&#39;: 2,
 &#39;YR1-n1-n1-1&#39;: 6,
 &#39;reachableI(n0)&#39;: 4,
 &#39;(var0=2)(n1)&#39;: 1,
 &#39;(var0=0)(n0)&#39;: 1,
 &#39;(ng,move-right)&#39;: 2,
 &#39;(n0,n0)&#39;: 7,
 &#39;(n0,move-right,ng)&#39;: 3,
 &#39;YR1-n1-n0-1&#39;: 6,
 &#39;YR1-n0-ng-0&#39;: 6,
 &#39;reachableG(n1,0)&#39;: 5,
 &#39;YR1-n1-n1-0&#39;: 6,
 &#39;(n1,n0)&#39;: 7,
 &#39;(var0=0)(ng)&#39;: 1,
 &#39;YR1-n0-ng-1&#39;: 6,
 &#39;(ng,move-right,n1)&#39;: 3,
 &#39;reachableI(n1)&#39;: 4,
 &#39;(ng,n1)&#39;: 7,
 &#39;reachableG(n1,2)&#39;: 5,
 &#39;YR1-n0-n1-1&#39;: 6,
 &#39;(var0=1)(n0)&#39;: 1,
 &#39;(n0,move-right(l2,l1))&#39;: 2,
 &#39;(n1,move-right(l2,l1))&#39;: 2,
 &#39;(n0,ng)&#39;: 7,
 &#39;(n0,move-right,n0)&#39;: 3,
 &#39;(ng,n0)&#39;: 7,
 &#39;YR1-n1-ng-0&#39;: 6,
 &#39;reachableG(n0,0)&#39;: 5,
 &#39;(var0=1)(ng)&#39;: 1,
 &#39;(n0,move-right(l1,l2))&#39;: 2,
 &#39;(n1,move-right)&#39;: 2,
 &#39;reachableG(n0,2)&#39;: 5,
 &#39;(n0,move-right(l3,l2))&#39;: 2,
 &#39;reachableG(n0,1)&#39;: 5,
 &#39;YR1-n0-n1-0&#39;: 6,
 &#39;(n1,move-right(l2,l3))&#39;: 2,
 &#39;(ng,move-right,ng)&#39;: 3,
 &#39;reachableG(ng,2)&#39;: 5,
 &#39;(var0=2)(n0)&#39;: 1,
 &#39;(n0,n1)&#39;: 7}
</code></pre></div> <p>最终找到的SAT解答</p> <div class=highlight><pre><span></span><code>SAT
SAT
-1 -2 3 4 5 -6 -7 -8 -9 -10 -11 12 13 -14 -15 -16 -17 -18 -19 -20 -21 22 23 -24 -25 26 -27 -28 -29 30 -31 -32 -33 -34 35 -36 -37 -38 39 -40 -41 -42 43 44 45 46 47 48 49 50 -51 -52 -53 54 55 -56 57 58 59 60 61 62 63 64 65 66 0
</code></pre></div> <p>对应的命题：</p> <div class=highlight><pre><span></span><code>&gt;&gt;&gt; print(cnf.mapNumberVariable)
{
3: &#39;(var0=2)(ng)&#39;, 
4: &#39;(n0,move-right(l2,l3))&#39;, 
5: &#39;(n0,move-right(l2,l1))&#39;, 
12: &#39;(n1,move-right(l1,l2))&#39;, 
13: &#39;(var0=0)(n1)&#39;, 
22: &#39;(n0,move-right)&#39;, 
23: &#39;(n1,move-right)&#39;, 
26: &#39;(n0,move-right,n1)&#39;, 
30: &#39;(n1,move-right,ng)&#39;, 
35: &#39;(n0,n1)&#39;, 
39: &#39;(n1,ng)&#39;, 
43: &#39;reachableI(n0)&#39;, 
44: &#39;reachableI(n1)&#39;, 
45: &#39;reachableI(ng)&#39;, 
46: &#39;reachableG(n0,2)&#39;, 
47: &#39;reachableG(n1,2)&#39;, 
48: &#39;reachableG(ng,2)&#39;, 
49: &#39;reachableG(ng,0)&#39;, 
50: &#39;reachableG(ng,1)&#39;, 
54: &#39;reachableG(n1,1)&#39;, 
55: &#39;YR1-n0-n0-0&#39;, 
57: &#39;YR1-n0-ng-0&#39;, 
58: &#39;YR1-n1-n0-0&#39;, 
59: &#39;YR1-n1-n1-0&#39;, 
60: &#39;YR1-n1-ng-0&#39;, 
61: &#39;YR1-n0-n0-1&#39;, 
62: &#39;YR1-n0-n1-1&#39;, 
63: &#39;YR1-n0-ng-1&#39;, 
64: &#39;YR1-n1-n0-1&#39;, 
65: &#39;YR1-n1-n1-1&#39;, 
66: &#39;YR1-n1-ng-1&#39;}
</code></pre></div> <h2 id=cnfpy>cnf.py<a class=headerlink href=#cnfpy title="Permanent link">&para;</a></h2> <table width=100% border=0 cellspacing=0 cellpadding=2 summary=section><tbody><tr><td width=100%><p><table width=100% border=0 cellspacing=0 cellpadding=2 summary=section><tbody><tr bgcolor=#ffc8d8><td valign=bottom colspan=3><font color=#000000 face="helvetica, arial"><a name=CNF>class <strong>CNF</strong></a>(<a href=http://localhost:8080/builtins.html#object>builtins.object</a>)</font></td></tr><tr bgcolor=#ffc8d8><td rowspan=2><tt>&nbsp;&nbsp;&nbsp;</tt></td><td colspan=2><tt><a href=http://localhost:8080/CNF.html#CNF>CNF</a>(n_file,&nbsp;n_file_extra,&nbsp;fair,&nbsp;strong)<br>&nbsp;<br><br>&nbsp;</tt></td></tr><tr><td>&nbsp;</td><td width=100%>Methods defined here:<br><dl><dt><a name=CNF-__init__><strong>__init__</strong></a>(self, n_file, n_file_extra, fair, strong)</dt><dd><tt>Initialize&nbsp;self.&nbsp;&nbsp;See&nbsp;help(type(self))&nbsp;for&nbsp;accurate&nbsp;signature.</tt></dd></dl><dl><dt><a name=CNF-addClause><strong>addClause</strong></a>(self, clause)</dt></dl><dl><dt><a name=CNF-addClauseExtra><strong>addClauseExtra</strong></a>(self, clause)</dt></dl><dl><dt><a name=CNF-alreadyUsed><strong>alreadyUsed</strong></a>(self, var)</dt></dl><dl><dt><a name=CNF-assignKey><strong>assignKey</strong></a>(self, var, typeVar=-1)</dt></dl><dl><dt><a name=CNF-generateAfterG><strong>generateAfterG</strong></a>(self, n)</dt></dl><dl><dt><a name=CNF-generateAtLeastOneAction><strong>generateAtLeastOneAction</strong></a>(self, task, controllerStates, debug)</dt></dl><dl><dt><a name=CNF-generateAtomControllerState><strong>generateAtomControllerState</strong></a>(self, atom, controllerState)</dt></dl><dl><dt><a name=CNF-generateCompletionReachabilityG><strong>generateCompletionReachabilityG</strong></a>(self, task, controllerStates, k, debug=False)</dt></dl><dl><dt><a name=CNF-generateConn><strong>generateConn</strong></a>(self, CStates)</dt></dl><dl><dt><a name=CNF-generateFirstG><strong>generateFirstG</strong></a>(self, n)</dt></dl><dl><dt><a name=CNF-generateGeneralizeConnection><strong>generateGeneralizeConnection</strong></a>(self, task, controllerStates, debug=False)</dt></dl><dl><dt><a name=CNF-generateGoal><strong>generateGoal</strong></a>(self, task, goalCState, debug=False)</dt></dl><dl><dt><a name=CNF-generateInequalityN><strong>generateInequalityN</strong></a>(self, n1, n2)</dt></dl><dl><dt><a name=CNF-generateInitial><strong>generateInitial</strong></a>(self, task, initialCState, debug=False)</dt></dl><dl><dt><a name=CNF-generateInputSat><strong>generateInputSat</strong></a>(self, nameFile)</dt></dl><dl><dt><a name=CNF-generateLowerPredecessor><strong>generateLowerPredecessor</strong></a>(self, n1, n2)</dt></dl><dl><dt><a name=CNF-generateMutexGroupsClauses><strong>generateMutexGroupsClauses</strong></a>(self, task, controllerStates, debug=False)</dt></dl><dl><dt><a name=CNF-generateNegativeForwardPropagation><strong>generateNegativeForwardPropagation</strong></a>(self, task, controllerStates, debug)</dt></dl><dl><dt><a name=CNF-generateOneSuccessor><strong>generateOneSuccessor</strong></a>(self, task, controllerStates, debug=False)</dt></dl><dl><dt><a name=CNF-generatePairActionControllerState><strong>generatePairActionControllerState</strong></a>(self, action, controllerState)</dt></dl><dl><dt><a name=CNF-generatePairCSCS><strong>generatePairCSCS</strong></a>(self, n1, n2)</dt></dl><dl><dt><a name=CNF-generatePairFairCS><strong>generatePairFairCS</strong></a>(self, n)</dt></dl><dl><dt><a name=CNF-generatePairUnfairCS><strong>generatePairUnfairCS</strong></a>(self, n)</dt></dl><dl><dt><a name=CNF-generatePossibleNonDet><strong>generatePossibleNonDet</strong></a>(self, task, controllerStates, debug=False)</dt></dl><dl><dt><a name=CNF-generatePreconditions><strong>generatePreconditions</strong></a>(self, task, controllerStates, debug=False)</dt></dl><dl><dt><a name=CNF-generatePropagationIG><strong>generatePropagationIG</strong></a>(self, task, controllerStates, k, debug=False)</dt></dl><dl><dt><a name=CNF-generatePropagationReachableGCyclic><strong>generatePropagationReachableGCyclic</strong></a>(self, task, controllerStates, k, debug=False)</dt></dl><dl><dt><a name=CNF-generatePropagationReachableGStrong><strong>generatePropagationReachableGStrong</strong></a>(self, task, controllerStates, k, debug=False)</dt></dl><dl><dt><a name=CNF-generatePropagationReachableGUnfair><strong>generatePropagationReachableGUnfair</strong></a>(self, task, controllerStates, k, debug=False)</dt></dl><dl><dt><a name=CNF-generatePropagationReachableI><strong>generatePropagationReachableI</strong></a>(self, task, controllerStates, debug=False)</dt></dl><dl><dt><a name=CNF-generateReachableG><strong>generateReachableG</strong></a>(self, controllerState, j)</dt></dl><dl><dt><a name=CNF-generateReachableGClauses><strong>generateReachableGClauses</strong></a>(self, task, controllerStates, goalCState, k, debug=False)</dt></dl><dl><dt><a name=CNF-generateReachableGInitial><strong>generateReachableGInitial</strong></a>(self, task, goalCState, controllerStates, numberControllerStates, debug=False)</dt></dl><dl><dt><a name=CNF-generateReachableI><strong>generateReachableI</strong></a>(self, controllerState)</dt></dl><dl><dt><a name=CNF-generateReachableI2><strong>generateReachableI2</strong></a>(self, controllerState, j)</dt></dl><dl><dt><a name=CNF-generateReachableIClauses><strong>generateReachableIClauses</strong></a>(self, task, initialCState, controllerStates, k, debug=False)</dt></dl><dl><dt><a name=CNF-generateReachableIinitial><strong>generateReachableIinitial</strong></a>(self, initialCState, debug=False)</dt></dl><dl><dt><a name=CNF-generateReplacementEquality><strong>generateReplacementEquality</strong></a>(self, n1, n2, atom)</dt></dl><dl><dt><a name=CNF-generateReplacementGoalPropagation><strong>generateReplacementGoalPropagation</strong></a>(self, controllerState1, controllerState2, i)</dt></dl><dl><dt><a name=CNF-generateReplacementGoalPropagation3><strong>generateReplacementGoalPropagation3</strong></a>(self, controllerState1, controllerState2, i)</dt></dl><dl><dt><a name=CNF-generateReplacementIPropagation><strong>generateReplacementIPropagation</strong></a>(self, controllerState1, controllerState2, i)</dt></dl><dl><dt><a name=CNF-generateSymmetryBreaking><strong>generateSymmetryBreaking</strong></a>(self, task, controllerStates, initialCState, goalCState, debug=False)</dt></dl><dl><dt><a name=CNF-generateTripletCSACS><strong>generateTripletCSACS</strong></a>(self, initialState, action, finalState)</dt></dl><dl><dt><a name=CNF-generateTripletForcesBin><strong>generateTripletForcesBin</strong></a>(self, task, controllerStates, debug=False)</dt></dl><dl><dt><a name=CNF-generate_clauses><strong>generate_clauses</strong></a>(self, task, initialCState, goalCState, controllerStates, k, parser=None, debug=False)</dt></dl><dl><dt><a name=CNF-getNumberClauses><strong>getNumberClauses</strong></a>(self)</dt></dl><dl><dt><a name=CNF-getNumberVariables><strong>getNumberVariables</strong></a>(self)</dt></dl><dl><dt><a name=CNF-get_num_cl_vars><strong>get_num_cl_vars</strong></a>(self)</dt></dl><dl><dt><a name=CNF-parseOutput><strong>parseOutput</strong></a>(self, nameFile, controllerStates, parser, print_policy=False)</dt></dl><dl><dt><a name=CNF-printClausesSizes><strong>printClausesSizes</strong></a>(self, n)</dt></dl><dl><dt><a name=CNF-printMapVarNumber><strong>printMapVarNumber</strong></a>(self)</dt></dl><dl><dt><a name=CNF-printVariables><strong>printVariables</strong></a>(self)</dt></dl><dl><dt><a name=CNF-reset><strong>reset</strong></a>(self)</dt></dl><dl><dt><a name=CNF-setFairUnfairActions><strong>setFairUnfairActions</strong></a>(self, task, controllerStates)</dt></dl><dl><dt><a name=CNF-writeDisjunctions><strong>writeDisjunctions</strong></a>(self, file)</dt></dl><hr>Data descriptors defined here:<br><dl><dt><strong>__dict__</strong></dt><dd><tt>dictionary&nbsp;for&nbsp;instance&nbsp;variables&nbsp;(if&nbsp;defined)</tt></dd></dl><dl><dt><strong>__weakref__</strong></dt><dd><tt>list&nbsp;of&nbsp;weak&nbsp;references&nbsp;to&nbsp;the&nbsp;object&nbsp;(if&nbsp;defined)</tt></dd></dl><hr>Data and other attributes defined here:<br><dl><dt><strong>num_types</strong> = 18</dt></dl><dl><dt><strong>print_types</strong> = [1, 2, 3, 7]</dt></dl><dl><dt><strong>type1</strong> = 'Atom-Controller'</dt></dl><dl><dt><strong>type10</strong> = 'Replacement-Goal'</dt></dl><dl><dt><strong>type2</strong> = 'Action-Controller'</dt></dl><dl><dt><strong>type3</strong> = 'Triplet'</dt></dl><dl><dt><strong>type4</strong> = 'Reachable-I'</dt></dl><dl><dt><strong>type5</strong> = 'Reachable-G'</dt></dl><dl><dt><strong>type6</strong> = 'Replacement-Goal'</dt></dl><dl><dt><strong>type7</strong> = 'Controller-Controller'</dt></dl><dl><dt><strong>type8</strong> = 'Replacement-Equality'</dt></dl><dl><dt><strong>type9</strong> = 'Inequality-CSCS'</dt></dl></td></tr></tbody></table></p></td></tr></tbody></table> <p>入口函数</p> <div class=highlight><pre><span></span><code>    #唯一重点，一行代码
    cnf.generate_clauses(my_task, &#39;n0&#39;, &#39;ng&#39;, controllerStates, len(controllerStates), p, show_gen_info)
    #生成子句Clauses和写入cnf文件合取范式的核心代码!!!
</code></pre></div> <p>查看定义：</p> <div class=highlight><pre><span></span><code>    def generate_clauses(self, task, initialCState, goalCState, controllerStates, k, parser = None, debug = False):
        self.generateInitial(task, initialCState, debug)
        self.generateGoal(task, goalCState, debug)
        self.generatePreconditions(task, controllerStates, debug)
        self.generatePossibleNonDet(task, controllerStates, debug)
        self.generateOneSuccessor(task, controllerStates, debug)
        self.generateTripletForcesBin(task, controllerStates, debug)
        self.generateAtLeastOneAction(task, controllerStates, debug)
        self.generateNegativeForwardPropagation(task, controllerStates, debug)
        self.generateGeneralizeConnection(task, controllerStates, debug)
        self.generateReachableIClauses(task, initialCState, controllerStates, k, debug)
        self.generateReachableGClauses(task, controllerStates, goalCState, k, debug)
        self.generateSymmetryBreaking(task, controllerStates, initialCState, goalCState, debug)
        self.generateMutexGroupsClauses(task, controllerStates, debug)
</code></pre></div> <h2 id=cnf_1>cnf源码加解析各自的类<a class=headerlink href=#cnf_1 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code>import sys
from myTask import MyTask
from timeit import default_timer as timer
import os

class MyCNFError(Exception):
  def __init__(self, value):
    self.value = value
  def __str__(self):
    return repr(self.value)

class CNF:
    type1 = &#39;Atom-Controller&#39;
    type2 = &#39;Action-Controller&#39;
    type3 = &#39;Triplet&#39;
    type4 = &#39;Reachable-I&#39;
    type5 = &#39;Reachable-G&#39;
    type6 = &#39;Replacement-Goal&#39;
    type7 = &#39;Controller-Controller&#39;
    type8 = &#39;Replacement-Equality&#39;
    type9 = &#39;Inequality-CSCS&#39;
    type10 = &#39;Replacement-Goal&#39;
    num_types = 18
    print_types = [1, 2, 3, 7]

    def __init__(self, n_file, n_file_extra, fair, strong):
        self.disjunctions = [] # list of disjunctions
        self.maxKey = 1
        self.mapVariableNumber = {}
        self.mapNumberVariable = {}
        self.mapVariableType = {}
        self.clauseSizeCounter = {}
        self.name_file_formula = n_file
        self.name_file_formula_extra = n_file_extra
        self.file_formula = open(n_file, &#39;w&#39;)
        self.file_formula_extra = open(n_file_extra, &#39;w&#39;)
        self.file_formula.close()
        self.file_formula_extra.close()
        self.number_clauses = 0
        self.fair   = fair
        self.strong = strong

    def reset(self):
        self.disjunctions = [] # list of disjunctions
        self.maxKey = 1
        self.mapVariableNumber = {}
        self.mapNumberVariable = {}
        self.mapVariableType = {}
        self.clauseSizeCounter = {}
        self.file_formula = open(self.name_file_formula, &#39;w&#39;)
        self.file_formula.write(&#39;p cnf 1 1\n&#39;)
        self.file_formula_extra = open(self.name_file_formula_extra, &#39;a&#39;)
        # File formula extra is not used, can be ignored
        self.number_clauses = 0
</code></pre></div> <p>代码接上，标记方便跳转查看</p> <h2 id=general>GENERAl通用功能性函数<a class=headerlink href=#general title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code>    ###########################################
    ################# GENERAL #################
    ###########################################

    def generateAtomControllerState(self, atom, controllerState):
        var = atom + &#39;(&#39; + controllerState + &#39;)&#39;
        self.assignKey(var, 1)
        return var

    def generatePairActionControllerState(self, action, controllerState):
        var = &#39;(&#39; + controllerState + &#39;,&#39; + action + &#39;)&#39;
        self.assignKey(var, 2)
        return var

    def generateTripletCSACS(self, initialState, action, finalState):
        var = &#39;(&#39; + initialState + &#39;,&#39; + action + &#39;,&#39; + finalState + &#39;)&#39;
        self.assignKey(var, 3)
        return var

    def generateReachableI(self, controllerState):
        var = &#39;reachableI(&#39; + controllerState + &#39;)&#39;
        self.assignKey(var, 4)
        return var

    def generateReachableI2(self, controllerState, j):
        var = &#39;reachableI(&#39; + controllerState + &#39;,&#39; + str(j) + &#39;)&#39;
        self.assignKey(var, 4)
        return var

    def generateReachableG(self, controllerState, j):
        var = &#39;reachableG(&#39; + controllerState + &#39;,&#39; + str(j) + &#39;)&#39;
        self.assignKey(var, 5)
        return var

    def generateReplacementGoalPropagation(self, controllerState1, controllerState2, i):
        var = &#39;YR1-&#39; + controllerState1 + &#39;-&#39; + controllerState2 + &#39;-&#39; + str(i)
        self.assignKey(var, 6)
        return var

    def generateReplacementGoalPropagation3(self, controllerState1, controllerState2, i):
        var = &#39;YR1-FAIR-&#39; + controllerState1 + &#39;-&#39; + controllerState2 + &#39;-&#39; + str(i)
        self.assignKey(var, 6)
        return var

    def generatePairCSCS(self, n1, n2):
        var = &#39;(&#39; + n1 + &#39;,&#39; + n2 + &#39;)&#39;
        self.assignKey(var, 7)
        return var

    def generateReplacementEquality(self, n1, n2, atom):
        var = &#39;YR2-&#39; + n1 + &#39;-&#39; + n2 + &#39;-&#39; + atom
        self.assignKey(var, 8)
        return var

    def generateInequalityN(self, n1, n2): # n1 &lt; n2
        var = n1 + &#39;&lt;&#39; + n2
        self.assignKey(var, 9)
        return var  

    def generateReplacementIPropagation(self, controllerState1, controllerState2, i):
        var = &#39;YR3-&#39; + controllerState1 + &#39;-&#39; + controllerState2 + &#39;-&#39; + str(i)
        self.assignKey(var, 10)
        return var

    def generateFirstG(self, n):
        var = &#39;FirstG(&#39; + str(n) + &#39;)&#39;
        self.assignKey(var, 13)
        return var

    def generateAfterG(self, n):
        var = &#39;AfterG(&#39; + str(n) + &#39;)&#39;
        self.assignKey(var, 14)
        return var

    def generateConn(self, CStates):
        var = &#39;conn(&#39;
        for n in CStates:
            var += str(n) + &#39;,&#39;
        var += &#39;)&#39;
        self.assignKey(var, 15)
        return var

    def generatePairFairCS(self, n):
        var = &#39;F(&#39; + n + &#39;,fair)&#39;
        self.assignKey(var, 16)
        return var

    def generatePairUnfairCS(self, n):
        var = &#39;U(&#39; + n + &#39;,unfair)&#39;
        self.assignKey(var, 17)
        return var

    def generateLowerPredecessor(self, n1, n2):
        var = &#39;Lower(&#39; + n1 + &#39;, &#39; + n2 + &#39;)&#39;
        self.assignKey(var, 18)
        return var

    def generateInputSat(self, nameFile):
        self.file_formula.close()
        with open(nameFile, &#39;r&#39;) as formula:
            name_final = nameFile + &#39;header&#39;
            with open(name_final, &#39;w&#39;) as final_formula:
                final_formula.write(&#39;p cnf %i %i\n&#39; % (len(self.mapNumberVariable), self.number_clauses))
                first_line = True
                for line in formula:
                    if first_line:
                        first_line = False
                        continue
                    final_formula.write(line)
        # name_final is the name of the file that contains the formula with header and everything
        return name_final

    def writeDisjunctions(self, file):
        for i in self.disjunctions:
            for j in i:
                if j[0] == &#39;-&#39;:
                    file.write(&#39;-&#39; + str(self.mapVariableNumber[j[1:]]) + &#39;\t&#39;)
                else:
                    file.write(str(self.mapVariableNumber[j]) + &#39;\t&#39;)
            file.write(&#39;0\n&#39;)

    # def printDisjunctions(self):
    #   for i in self.disjunctions:
    #       for j in i:
    #           print j + &#39; &#39;,
    #       print &#39;\n&#39;,

    # def printDisjunctionsNumbers(self, printExpanded):
    #   for i in self.disjunctions:
    #       if printExpanded:
    #           for j in i:
    #               print j + &#39;\t&#39;,
    #           print &#39;&#39;
    #       for j in i:
    #           if j[0] == &#39;-&#39;:
    #               print &#39;-&#39; + str(self.mapVariableNumber[j[1:]]), &#39;\t&#39;,
    #           else:
    #               print self.mapVariableNumber[j], &#39;\t&#39;,
    #       print &#39; 0&#39;

    def printVariables(self):
        for i in self.mapVariableNumber:
            print(i)
</code></pre></div> <h2 id=parseoutputpolicy>parseOutput输出解决policy<a class=headerlink href=#parseoutputpolicy title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code>    def parseOutput(self, nameFile, controllerStates, parser, print_policy = False):
        sets = [set([]) for i in range(self.num_types)]
        fres = open(nameFile, &#39;r&#39;)
        res = fres.readlines()
        if &#39;UNSAT&#39; in res[0]:
            return False
        if &#39;INDET&#39; in res[0]:
            return None
        if not print_policy:
            return True
        res = res[1]
        res = res.split(&#39; &#39;)
        for r in res:
            if &#39;\n&#39; in res:
                continue
            var = int(r)
            if var &gt; 0:
                varName = self.mapNumberVariable[var]
                t = self.mapVariableType[varName]
                sets[t - 1].add(varName)
        print(&#39;===================\n===================&#39;)
        print(&#39;Controller -- CS = Controller State&#39;)
        for i in range(len(sets)):
            if i + 1 in self.print_types:
                s = sets[i]
                if i == 0:
                    # pair atom controller
                    print(&#39;===================\n===================&#39;)
                    print(&#39;Atom (CS)&#39;)
                    print(&#39;___________________&#39;)
                    for n in controllerStates:
                        print(&#39;----------&#39;)
                        for j in s:
                            ind = &#39;(&#39; + n + &#39;)&#39;
                            if ind in j:
                                print(&#39;%s %s&#39; % (str(parser.get_var_string(j.split(ind)[0])), str(ind)))
                elif i == 1:
                    # pair cs action
                    print(&#39;===================\n===================&#39;)
                    print(&#39;(CS, Action with arguments)&#39;)
                    print(&#39;___________________&#39;)
                    for n in controllerStates:
                        for j in s:
                            if &#39;(&#39; + n + &#39;,&#39; in j:
                                print(j)
                elif i == 2:
                    # Triplet
                    print(&#39;===================\n===================&#39;)
                    print(&#39;(CS, Action name, CS)&#39;)
                    print(&#39;___________________&#39;)
                    for n in controllerStates:
                        for j in s:
                            if &#39;(&#39; + n + &#39;,&#39; in j:
                                print(j)
                else:
                    print(&#39;===================&#39;)
                    print(&#39;(CS, CS)&#39;)
                    print(&#39;___________________&#39;)
                    for j in s:
                        print(j)
        print(&#39;===================&#39;)
        print(&#39;Solved with %i states&#39; % len(controllerStates))
        return True

    def getNumberVariables(self):
        return len(self.mapVariableNumber)

    def getNumberClauses(self):
        return self.number_clauses

    def printMapVarNumber(self):
        for i in self.mapVariableNumber:
            print(i, &#39;--&gt;&#39;, self.mapVariableNumber[i])

    def alreadyUsed(self, var):
        if var in self.mapVariableNumber:
            return True
        return False

    def assignKey(self, var, typeVar = -1):
        if not self.alreadyUsed(var):
            self.mapVariableNumber[var] = self.maxKey
            self.mapNumberVariable[self.maxKey] = var
            self.mapVariableType[var] = typeVar
            self.maxKey += 1

    def get_num_cl_vars(self):
        return self.getNumberClauses(), self.getNumberVariables()

    def addClause(self, clause):
        self.number_clauses += 1
        for j in clause:
            negated = (j[0] == &#39;-&#39;)
            if negated:
                var = j[1:]
            else:
                var = j
            if negated:
                self.file_formula.write(&#39;-&#39; + str(self.mapVariableNumber[var]) + &#39;\t&#39;)
            else:
                self.file_formula.write(str(self.mapVariableNumber[var]) + &#39;\t&#39;)
        self.file_formula.write(&#39;0\n&#39;)

    def addClauseExtra(self, clause):
        for j in clause:
            self.file_formula_extra.write(j + &#39;|&#39;)
        self.file_formula_extra.write(&#39;\n&#39;)
        # j1|j2|...|jn|\n

    def printClausesSizes(self, n):
        print(self.clauseSizeCounter)
        sum_all = 0
        sum_greater = 0
        for i in self.clauseSizeCounter:
            sum_all += self.clauseSizeCounter[i]
            if i &gt;= n:
                sum_greater += self.clauseSizeCounter[i]
            else:
                print(i, &#39;:&#39;, self.clauseSizeCounter[i])
        print(&#39;&gt;=&#39;, i, &#39;:&#39;, sum_greater)
</code></pre></div> <p>代码接上，标记方便跳转查看</p> <h2 id=generate_clauses>generate_clauses核心入口类<a class=headerlink href=#generate_clauses title="Permanent link">&para;</a></h2> <p>main.py 高潮部分：注意留意重点：</p> <div class=highlight><pre><span></span><code>solver_time = []
for i in range(1000):
    cnf = CNF(name_formula_file, name_formula_file_extra, fair, strong)#文件formula-temp.txt这时候是空白的，formula-extra-temp此时空白，仅仅是传入地址方便最终结果存入数据
    ......
    cnf.reset()
      start_g = timer()
    cnf.generate_clauses(my_task, &#39;n0&#39;, &#39;ng&#39;, controllerStates, len(controllerStates), p, show_gen_info)#生成子句Clauses和写入cnf文件合取范式的核心代码!!!
    ......
    command = &#39;./minisat %s %s&#39; % (name_formula_file, name_output_satsolver)#调用minisat
    ......
    result = cnf.parseOutput(name_output_satsolver, controllerStates, p, print_policy)#读取文件name_output_satsolver : outsat-temp.txt输出结果
    ......
</code></pre></div> <p>cnf.py</p> <div class=highlight><pre><span></span><code>    ###########################################
    ############## GENERATION #################
    ###########################################

    def generate_clauses(self, task, initialCState, goalCState, controllerStates, k, parser = None, debug = False):
        self.generateInitial(task, initialCState, debug)
        self.generateGoal(task, goalCState, debug)
        self.generatePreconditions(task, controllerStates, debug)
        self.generatePossibleNonDet(task, controllerStates, debug)
        self.generateOneSuccessor(task, controllerStates, debug)
        self.generateTripletForcesBin(task, controllerStates, debug)
        self.generateAtLeastOneAction(task, controllerStates, debug)
        self.generateNegativeForwardPropagation(task, controllerStates, debug)
        self.generateGeneralizeConnection(task, controllerStates, debug)
        self.generateReachableIClauses(task, initialCState, controllerStates, k, debug)
        self.generateReachableGClauses(task, controllerStates, goalCState, k, debug)
        self.generateSymmetryBreaking(task, controllerStates, initialCState, goalCState, debug)
        self.generateMutexGroupsClauses(task, controllerStates, debug)
</code></pre></div> <p>代码接上，标记方便跳转查看</p> <h2 id=generate_clauses_1>generate_clauses调用的生成子句的类<a class=headerlink href=#generate_clauses_1 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code>    ###########################################
    ################ INITIAL ##################
    ###########################################

    def generateInitial(self, task, initialCState, debug = False):
        # -p(n0) for all p not in initial state
        c1, v1 = self.get_num_cl_vars()
        start = timer()
        initial = task.get_initial()
        atoms = task.get_atoms()
        for a in atoms:
            if a not in initial:
                variable = self.generateAtomControllerState(a, initialCState)
                self.addClause([&#39;-&#39; + variable])

        c2, v2 = self.get_num_cl_vars()
        if debug:
            print(&#39;Generation: Initial\t\t v %i \t\t c : %i \t\t %f&#39; % (v2 - v1, c2 - c1, timer() - start))

    ###########################################
    ############## GOAL #######################
    ###########################################

    def generateGoal(self, task, goalCState, debug = False):
        # p(ng) for all p in goal state
        c1, v1 = self.get_num_cl_vars()
        start = timer()
        goal = task.get_goal()
        atoms = task.get_atoms()
        for a in atoms:
            if a in goal:
                variable = self.generateAtomControllerState(a, goalCState)
                self.addClause([variable])

        c2, v2 = self.get_num_cl_vars()
        if debug:
            print(&#39;Generation: Goal\t\t v %i \t\t c : %i \t\t %f&#39; % (v2 - v1, c2 - c1, timer() - start))

    ###########################################
    ############## PRECONDITIONS ##############
    ###########################################

    def generatePreconditions(self, task, controllerStates, debug = False):
        # (n, b) --&gt; p(n) // if p \in prec(b)
        c1, v1 = self.get_num_cl_vars()
        start = timer()
        atoms = task.get_atoms()
        actions = task.get_actions()

        for n in controllerStates:
            for a in actions:
                pre = task.get_preconditions(a)
                var = self.generatePairActionControllerState(a, n)
                for p in pre:
                    varPre = self.generateAtomControllerState(p, n)
                    self.addClause([&#39;-&#39; + var, varPre])
                    # print clause + [varPre] # DEBUG

        c2, v2 = self.get_num_cl_vars()
        if debug:
            print(&#39;Generation: Precs\t\t v %i \t\t c : %i \t\t %f&#39; % (v2 - v1, c2 - c1, timer() - start))


    ###########################################
    ############## NON-DET ####################
    ###########################################

    def generatePossibleNonDet(self, task, controllerStates, debug = False):
        # 1. (n, act) --&gt; (n, act&#39;) // act, act&#39; are non det act of equal det action (action names)
        # 2. (n, act) --&gt; -(n, act&#39;&#39;) //
        # 3. (n, b) --&gt; (n, b&#39;) // b, b&#39; are siblings
        # 4. (n, b) --&gt; -(n, b&#39;&#39;) // b, b&#39;&#39; belong to same act
        c1, v1 = self.get_num_cl_vars()
        start = timer()
        acts = task.get_action_names()
        for n in controllerStates:
            for act in acts:
                var_pair = self.generatePairActionControllerState(act, n)
                other_acts = task.get_other_actions_name(act)
                for act2 in acts:
                    if act2 == act:
                        continue
                    var_pair2 = self.generatePairActionControllerState(act2, n)
                    if act2 in other_acts:
                        self.addClause([&#39;-&#39; + var_pair, var_pair2]) # 1
                    else:
                        self.addClause([&#39;-&#39; + var_pair, &#39;-&#39; + var_pair2]) # 2

                for a1 in task.get_actions_with_name(act):
                    var1 = self.generatePairActionControllerState(a1, n)
                    for a2 in task.get_actions_with_name(act):
                        if a2 == a1:
                            continue
                        if task.actions_are_compatible(a1, a2): # IMPORTANT!! ie. prec not mutex
                            var2 = self.generatePairActionControllerState(a2, n)
                            self.addClause([&#39;-&#39; + var1, &#39;-&#39; + var2]) # 4

            for a in task.get_actions():
                var1 = self.generatePairActionControllerState(a, n)
                other_actions = task.get_other_actions(a)
                for other in other_actions:
                    if other == a:
                        continue
                    var2 = self.generatePairActionControllerState(other, n)
                    self.addClause([&#39;-&#39; + var1, var2]) # 3

        c2, v2 = self.get_num_cl_vars()
        if debug:
            print(&#39;Generation: Non Det\t\t v %i \t\t c : %i \t\t %f&#39; % (v2 - v1, c2 - c1, timer() - start))

    ###########################################
    ############## ONE SUCC ###################
    ###########################################

    def generateOneSuccessor(self, task, controllerStates, debug = False):
        # 1. (n, act) --&gt; \OR_{b} (n, b) // for b with name act
        # 2. (n, act) --&gt; \OR_{n&#39;} (n, act, n&#39;)
        # 3. -(n, act, n&#39;) \lor -(n, act, n&#39;&#39;)
        # 4. (n, b) --&gt; (n, act)
        c1, v1 = self.get_num_cl_vars()
        start = timer()
        acts = task.get_action_names()

        for n1 in controllerStates:
            for a_name in acts:
                for n2 in controllerStates:
                    for n3 in controllerStates:
                        if n3 == n2:
                            continue
                        var1 = self.generateTripletCSACS(n1, a_name, n2)
                        var2 = self.generateTripletCSACS(n1, a_name, n3)
                        self.addClause([&#39;-&#39; + var1, &#39;-&#39; + var2]) # 3

                for a in task.get_actions_with_name(a_name):
                    pair1 = self.generatePairActionControllerState(a, n1)
                    pair2 = self.generatePairActionControllerState(a_name, n1)
                    self.addClause([&#39;-&#39; + pair1, pair2]) # 4

                var1 = self.generatePairActionControllerState(a_name, n1)
                var_triplets = []
                for n2 in controllerStates:
                    var_triplets.append(self.generateTripletCSACS(n1, a_name, n2))
                self.addClause([&#39;-&#39; + var1] + var_triplets) # 2

                var1 = self.generatePairActionControllerState(a_name, n1)
                var_bin = []
                for a in task.get_actions_with_name(a_name):
                    var_bin.append(self.generatePairActionControllerState(a, n1))
                self.addClause([&#39;-&#39; + var1] + var_bin) # 1

        c2, v2 = self.get_num_cl_vars()
        if debug:
            print(&#39;Generation: One succ\t\t v %i \t\t c : %i \t\t %f&#39; % (v2 - v1, c2 - c1, timer() - start))

    ###########################################
    ############## TRIPLET-BIN ################
    ###########################################

    def generateTripletForcesBin(self, task, controllerStates, debug = False):
        # (n, act, n&#39;) --&gt; (n, act)
        c1, v1 = self.get_num_cl_vars()
        start = timer()
        actions = task.get_action_names()
        for n1 in controllerStates:
            for a in actions:
                for n2 in controllerStates:
                    var1 = self.generateTripletCSACS(n1, a, n2)
                    var2 = self.generatePairActionControllerState(a, n1)
                    # print [&#39;-&#39; + var1, var2] # DEBUG
                    self.addClause([&#39;-&#39; + var1, var2])

        c2, v2 = self.get_num_cl_vars()
        if debug:
            print(&#39;Generation: Trip bin\t\t v %i \t\t c : %i \t\t %f&#39; % (v2 - v1, c2 - c1, timer() - start))

    ###########################################
    ############## ONE ACTION #################
    ###########################################

    def generateAtLeastOneAction(self, task, controllerStates, debug):
        # \OR_{act_name} (n, act) for all n except goal, ng
        c1, v1 = self.get_num_cl_vars()
        start = timer()
        actions = task.get_action_names()
        for n in controllerStates:
            if n == &#39;ng&#39;:
                continue
            disj = []
            for a in actions:
                pair = self.generatePairActionControllerState(a, n)
                disj.append(pair)
            self.addClause(disj)

        c2, v2 = self.get_num_cl_vars()
        if debug:
            print(&#39;Generation: One act\t\t v %i \t\t c : %i \t\t %f&#39; % (v2 - v1, c2 - c1, timer() - start))

    ###########################################
    ############## NEG-FORWARD PROP ###########
    ###########################################

    def __sibling_action_adds_atom(self, task, action, atom):
        siblings = task.get_other_actions(action)
        for a in siblings:
            add_list = task.get_add_list(a)
            if atom in add_list:
                return True
        return False

    def generateNegativeForwardPropagation(self, task, controllerStates, debug):
        # 1. (n, act, n&#39;) \land (n, b) --&gt; -p(n&#39;) // if p in delete list
        # 2. (n, n&#39;) \land -p(n) --&gt; -p(n&#39;) \lor \OR_{b: p \in add(b)} (n, b)
        # 3. (n, act, n&#39;) \land (n, b) \land -p(n) --&gt; -p(n&#39;) // if p \not \in add(b) 
        # and some sibling of b adds p
        c1, v1 = self.get_num_cl_vars()
        start = timer()
        atoms = task.get_atoms()
        actions = task.get_actions()

        #for a in actions:
        #   print(a, task.get_del_list(a))
        #   print(a, task.get_add_list(a))

        for n1 in controllerStates:
            for n2 in controllerStates:
                for p in atoms:
                    var_atom_n1 = self.generateAtomControllerState(p, n1)
                    var_pair_n1n2 = self.generatePairCSCS(n1, n2)
                    var_atom_n2 = self.generateAtomControllerState(p, n2)
                    disj_add_clause = [&#39;-&#39; + var_pair_n1n2, var_atom_n1, &#39;-&#39; + var_atom_n2]
                    for a in task.get_relevant_actions(p):
                        a_name = task.get_action_name(a)
                        del_list = task.get_del_list(a)
                        add_list = task.get_add_list(a)
                        var_triplet = self.generateTripletCSACS(n1, a_name, n2)
                        var_bin = self.generatePairActionControllerState(a, n1)
                        if p in del_list:
                            self.addClause([&#39;-&#39; + var_triplet, &#39;-&#39; + var_bin,&#39;-&#39; + var_atom_n2]) # 1
                        if p in add_list:
                            disj_add_clause.append(var_bin)
                        if p not in add_list and self.__sibling_action_adds_atom(task, a, p):
                            self.addClause([&#39;-&#39; + var_triplet, &#39;-&#39; + var_bin, var_atom_n1, &#39;-&#39; + var_atom_n2]) # 3
                    self.addClause(disj_add_clause) # 2

        c2, v2 = self.get_num_cl_vars()
        if debug:
            print(&#39;Generation: Neg Prop\t\t v %i \t\t c : %i \t\t %f&#39; % (v2 - v1, c2 - c1, timer() - start))

    ###########################################
    ############## GEN-CONNS ##################
    ###########################################

    def generateGeneralizeConnection(self, task, controllerStates, debug = False):
        # (n, n&#39;) &lt;--&gt; \OR_{act} (n, act, n&#39;)
        c1, v1 = self.get_num_cl_vars()
        start = timer()
        actions = task.get_action_names()
        for n1 in controllerStates:
            for n2 in controllerStates:
                varBin = self.generatePairCSCS(n1, n2)
                triplets = [&#39;-&#39; + varBin]
                for a in actions:
                    triplet = self.generateTripletCSACS(n1, a, n2)
                    self.addClause([&#39;-&#39; + triplet, varBin])
                    # print [&#39;-&#39; + triplet, varBin] # DEBUG
                    triplets.append(triplet)
                # print triplets # DEBUG
                self.addClause(triplets)

        c2, v2 = self.get_num_cl_vars()
        if debug:
            print(&#39;Generation: Gen conn\t\t v %i \t\t c : %i \t\t %f&#39; % (v2 - v1, c2 - c1, timer() - start))

    ###########################################
    ############## REACH-I ####################
    ###########################################

    def generateReachableIClauses(self, task, initialCState, controllerStates, k, debug = False):
        self.generateReachableIinitial(initialCState, debug)
        self.generatePropagationReachableI(task, controllerStates, debug)
        self.generatePropagationIG(task, controllerStates, k - 1, debug)

    def generateReachableIinitial(self, initialCState, debug = False):
        c1, v1 = self.get_num_cl_vars()
        start = timer()
        self.addClause([self.generateReachableI(initialCState)])

        c2, v2 = self.get_num_cl_vars()
        if debug:
            print(&#39;Generation: RI init\t\t v %i \t\t c : %i \t\t %f&#39; % (v2 - v1, c2 - c1, timer() - start))

    def generatePropagationReachableI(self, task, controllerStates, debug = False):
        c1, v1 = self.get_num_cl_vars()
        start = timer()
        for n1 in controllerStates:
            for n2 in controllerStates:
                var1 = self.generateReachableI(n1)
                var2 = self.generateReachableI(n2)
                var3 = self.generatePairCSCS(n1, n2)
                self.addClause([&#39;-&#39; + var3, &#39;-&#39; + var1, var2])

        c2, v2 = self.get_num_cl_vars()
        if debug:
            print(&#39;Generation: RI prop\t\t v %i \t\t c : %i \t\t %f&#39; % (v2 - v1, c2 - c1, timer() - start))

    def generatePropagationIG(self, task, controllerStates, k, debug = False):
        c1, v1 = self.get_num_cl_vars()
        start = timer()
        for n in controllerStates:
            var1 = self.generateReachableI(n)
            var2 = self.generateReachableG(n, k)
            self.addClause([&#39;-&#39; + var1, var2])

        c2, v2 = self.get_num_cl_vars()
        if debug:
            print(&#39;Generation: IG prop\t\t v %i \t\t c : %i \t\t %f&#39; % (v2 - v1, c2 - c1, timer() - start))

    ###########################################
    ############## REACH-G ####################
    ###########################################

    def generateReachableGClauses(self, task, controllerStates, goalCState, k, debug = False):
        self.generateReachableGInitial(task, goalCState, controllerStates, k - 1, debug)
        self.generateCompletionReachabilityG(task, controllerStates, k - 1, debug)
        if self.strong:
            self.generatePropagationReachableGStrong(task, controllerStates, k - 1, debug)
        else:
            if not self.fair:
                self.generatePropagationReachableGUnfair(task, controllerStates, k - 1, debug)
            else:
                self.generatePropagationReachableGCyclic(task, controllerStates, k - 1, debug)  

    def generateReachableGInitial(self, task, goalCState, controllerStates, numberControllerStates, debug = False):
        # ReachG(ng,0), ReachG(ng,1), ...
        # -ReachG(n, 0) for n != ng
        c1, v1 = self.get_num_cl_vars()
        start = timer()
        # set the initial values for goal state
        for i in range(numberControllerStates + 1):
            self.addClause([self.generateReachableG(goalCState, i)])
        # set the negation for non goal states
        for n in controllerStates:
            if n == goalCState:
                continue
            self.addClause([&#39;-&#39; + self.generateReachableG(n, 0)])

        c2, v2 = self.get_num_cl_vars()
        if debug:
            print(&#39;Generation: RG init\t\t v %i \t\t c : %i \t\t %f&#39; % (v2 - v1, c2 - c1, timer() - start))

    def generateCompletionReachabilityG(self, task, controllerStates, k, debug = False):
        # ReachG(n,j) --&gt; ReachG(n, j+1)
        c1, v1 = self.get_num_cl_vars()
        start = timer()
        for n in controllerStates:
            for i in range(k):
                var1 = self.generateReachableG(n, i)
                var2 = self.generateReachableG(n, i + 1)
                self.addClause([&#39;-&#39; + var1, var2])

        c2, v2 = self.get_num_cl_vars()
        if debug:
            print(&#39;Generation: RG compl\t\t v %i \t\t c : %i \t\t %f&#39; % (v2 - v1, c2 - c1, timer() - start))

    def setFairUnfairActions(self, task, controllerStates):
        # 1: (n, unfair) &lt;-&gt; \OR_{b: unf} (n,b)
        # 2: (n, fair) &lt;-&gt; \OR_{b: unf} (n,b)
        # 3: -(n, fair) \lor -(n, unfair)
        actions = task.get_action_names()
        for n in controllerStates:
            varPairUnf = self.generatePairUnfairCS(n)
            disj = [&#39;-&#39; + varPairUnf]
            for a in actions:
                if &#39;_unfair_&#39; in a:
                    varPair = self.generatePairActionControllerState(a, n)
                    self.addClause([&#39;-&#39; + varPair, varPairUnf]) # 1
                    # print([&#39;-&#39; + varPair, varPairUnf])
                    disj.append(varPair)
            self.addClause(disj) # 1
            # print(disj)
        for n in controllerStates:
            varPairF = self.generatePairFairCS(n)
            disj = [&#39;-&#39; + varPairF]
            for a in actions:
                if &#39;_unfair_&#39; not in a:
                    varPair = self.generatePairActionControllerState(a, n)
                    self.addClause([&#39;-&#39; + varPair, varPairF]) # 2
                    # print([&#39;-&#39; + varPair, varPairF])
                    disj.append(varPair) 
            self.addClause(disj) # 2
            # print(disj)
        for n in controllerStates:
            varF = self.generatePairFairCS(n)
            varU = self.generatePairUnfairCS(n)
            self.addClause([&#39;-&#39; + varF, &#39;-&#39; + varU]) # 3
            # print([&#39;-&#39; + varF, &#39;-&#39; + varU])

    def generatePropagationReachableGUnfair(self, task, controllerStates, k, debug = False):
        # ReachG(n, j+1) &lt;--&gt; [1] 
        # [1] = [2] \lor [3]
        # [2] = (n, unfair) \land \AND_{n&#39;} [(n,n&#39;) --&gt; RG(n&#39;,j)]
        # [3] = \OR_{n&#39;} [(n, fair) \land (n,n&#39;) \land RG(n&#39;,j)]
        c1, v1 = self.get_num_cl_vars()
        start = timer()
        # Set variables (n, fair) and (n, unfair)
        self.setFairUnfairActions(task, controllerStates)
        # Force the equivalences for [2]
        # [(n,n&#39;) --&gt; RG(n&#39;,j)] &lt;-&gt; Repl(n,n&#39;,j)
        for i in range(k):
            for n1 in controllerStates:
                if n1 == &#39;ng&#39;:
                    continue
                for n2 in controllerStates:
                    varRepl = self.generateReplacementGoalPropagation(n1, n2, i)
                    varPair = self.generatePairCSCS(n1, n2)
                    varRG   = self.generateReachableG(n2, i)
                    self.addClause([&#39;-&#39; + varRepl, &#39;-&#39; + varPair, varRG])
                    self.addClause([&#39;-&#39; + varRG, varRepl])
                    self.addClause([varPair, varRepl])
        # Force the equivalences for [3]
        # [(n, fair) \land (n,n&#39;) \land RG(n&#39;,j)] &lt;-&gt; Repl3(n,n&#39;,j)
        for i in range(k):
            for n1 in controllerStates:
                if n1 == &#39;ng&#39;:
                    continue
                for n2 in controllerStates:
                    varRepl = self.generateReplacementGoalPropagation3(n1, n2, i)
                    varPair = self.generatePairCSCS(n1, n2)
                    varFair = self.generatePairFairCS(n1)
                    varRG   = self.generateReachableG(n2, i)
                    self.addClause([&#39;-&#39; + varRepl, varPair])
                    self.addClause([&#39;-&#39; + varRepl, varFair])
                    self.addClause([&#39;-&#39; + varRepl, varRG])
                    self.addClause([varRepl, &#39;-&#39; + varPair, &#39;-&#39; + varFair, &#39;-&#39; + varRG])
        # Right arrow
        for n1 in controllerStates:
            if n1 == &#39;ng&#39;:
                continue
            for i in range(k):
                varRG = self.generateReachableG(n1, i + 1)
                listStrong = [self.generatePairUnfairCS(n1)]
                listCyclic = []
                for n in controllerStates:
                    listStrong.append(self.generateReplacementGoalPropagation(n1, n, i))
                    listCyclic.append(self.generateReplacementGoalPropagation3(n1, n, i))
                clause = [&#39;-&#39; + varRG] + listCyclic
                for e in listStrong:
                    self.addClause(clause + [e])
                    # print(clause + [e])
        # Left arrow
        for n1 in controllerStates:
            if n1 == &#39;ng&#39;:
                continue
            for i in range(k):
                varRG = self.generateReachableG(n1, i + 1)
                listStrong = [self.generatePairUnfairCS(n1)]
                listCyclic = []
                for n in controllerStates:
                    listStrong.append(self.generateReplacementGoalPropagation(n1, n, i))
                    listCyclic.append(self.generateReplacementGoalPropagation3(n1, n, i))
                self.addClause([varRG] + [&#39;-&#39; + e for e in listStrong])
                # print([varRG] + [&#39;-&#39; + e for e in listStrong])
                for e in listCyclic:
                    self.addClause([varRG, &#39;-&#39; + e])
                    # print([varRG, &#39;-&#39; + e])

        c2, v2 = self.get_num_cl_vars()
        if debug:
            print(&#39;Generation: RG prop\t\t v %i \t\t c : %i \t\t %f&#39; % (v2 - v1, c2 - c1, timer() - start))

    def generatePropagationReachableGCyclic(self, task, controllerStates, k, debug = False):
        # ReachG(n, j+1) &lt;--&gt; \OR_{n&#39;} [(n,n&#39;) \land ReachG(n&#39;, j)]
        c1, v1 = self.get_num_cl_vars()
        start = timer()
        # Force the equivalences
        for i in range(k):
            for n1 in controllerStates:
                if n1 == &#39;ng&#39;:
                    continue
                for n2 in controllerStates:
                    var1 = self.generateReplacementGoalPropagation(n1, n2, i)
                    var2 = self.generatePairCSCS(n1, n2)
                    var3 = self.generateReachableG(n2, i)
                    self.addClause([&#39;-&#39; + var1, var2])
                    self.addClause([&#39;-&#39; + var1, var3])
                    self.addClause([var1, &#39;-&#39; + var2, &#39;-&#39; + var3])
        # Right arrow
        for n1 in controllerStates:
            if n1 == &#39;ng&#39;:
                continue
            for i in range(k):
                var1 = self.generateReachableG(n1, i + 1)
                var2 = [&#39;-&#39; + var1]
                for n2 in controllerStates:
                    var3 = self.generateReplacementGoalPropagation(n1, n2, i)
                    var2.append(var3)
                self.addClause(var2)
        # Left arrow
        for n1 in controllerStates:
            if n1 == &#39;ng&#39;:
                continue
            for i in range(k):
                var1 = self.generateReachableG(n1, i + 1)
                for n2 in controllerStates:
                    var2 = self.generateReplacementGoalPropagation(n1, n2, i)
                    self.addClause([var1, &#39;-&#39; + var2])

        c2, v2 = self.get_num_cl_vars()
        if debug:
            print(&#39;Generation: RG prop\t\t v %i \t\t c : %i \t\t %f&#39; % (v2 - v1, c2 - c1, timer() - start))

    def generatePropagationReachableGStrong(self, task, controllerStates, k, debug = False):
        # ReachG(n, j+1) &lt;--&gt; \AND_{n&#39;} [(n,n&#39;) --&gt; ReachG(n&#39;, j)]
        c1, v1 = self.get_num_cl_vars()
        start = timer()
        # Force the equivalences
        for i in range(k):
            for n1 in controllerStates:
                if n1 == &#39;ng&#39;:
                    continue
                for n2 in controllerStates:
                    varRepl = self.generateReplacementGoalPropagation(n1, n2, i)
                    varPair = self.generatePairCSCS(n1, n2)
                    varRG   = self.generateReachableG(n2, i)
                    self.addClause([&#39;-&#39; + varRepl, &#39;-&#39; + varPair, varRG])
                    self.addClause([&#39;-&#39; + varRG, varRepl])
                    self.addClause([varPair, varRepl])
        # Right arrow
        for n1 in controllerStates:
            if n1 == &#39;ng&#39;:
                continue
            for i in range(k):
                varRG = self.generateReachableG(n1, i + 1)
                for n2 in controllerStates:
                    varRepl = self.generateReplacementGoalPropagation(n1, n2, i)
                    self.addClause([&#39;-&#39; + varRG, varRepl])
        # Left arrow
        for n1 in controllerStates:
            if n1 == &#39;ng&#39;:
                continue
            for i in range(k):
                disj = [self.generateReachableG(n1, i + 1)]
                for n2 in controllerStates:
                    varRepl = self.generateReplacementGoalPropagation(n1, n2, i)
                    disj.append(&#39;-&#39; + varRepl)
                self.addClause(disj)

        c2, v2 = self.get_num_cl_vars()
        if debug:
            print(&#39;Generation: RG prop\t\t v %i \t\t c : %i \t\t %f&#39; % (v2 - v1, c2 - c1, timer() - start))

    ###########################################
    ############## SYMM-BREAKING ##############
    ###########################################

    def generateSymmetryBreaking(self, task, controllerStates, initialCState, goalCState, debug = False):
        c1, v1 = self.get_num_cl_vars()
        start = timer()

        if len(controllerStates) &gt;= 4:
            # (na, nb) --&gt; \OR_{i&lt;=a} (n_i, n_{b-1})
            for ia, na in enumerate(controllerStates[:-1]):
                for ib, nb in enumerate(controllerStates[:-1]):
                    if ib in [0, 1]:
                        continue
                    nb_1 = controllerStates[ib - 1]
                    var_pair_ab = self.generatePairCSCS(na, nb)
                    disj = [&#39;-&#39; + var_pair_ab]
                    for i in range(ia + 1):
                        ni = controllerStates[i]
                        disj.append(self.generatePairCSCS(ni, nb_1))
                    self.addClause(disj)

        c2, v2 = self.get_num_cl_vars()
        if debug:
            print(&#39;Generation: Sym brk\t\t v %i \t\t c : %i \t\t %f&#39; % (v2 - v1, c2 - c1, timer() - start))


    ###########################################
    ############## MUTEX GROUPS ###############
    ###########################################

    def generateMutexGroupsClauses(self, task, controllerStates, debug = False):
        c1, v1 = self.get_num_cl_vars()
        start = timer()
        mutex_groups = task.get_mutex_groups()
        for mg in mutex_groups:
            pairs = self.__get_all_pairs(mg)
            for (a1, a2) in pairs:
                for n in controllerStates:
                    var1 = self.generateAtomControllerState(a1, n)
                    var2 = self.generateAtomControllerState(a2, n)
                    self.addClause([&#39;-&#39; + var1, &#39;-&#39; + var2])

        c2, v2 = self.get_num_cl_vars()
        if debug:
            print(&#39;Generation: Mutex\t\t v %i \t\t c : %i \t\t %f&#39; % (v2 - v1, c2 - c1, timer() - start))

    def __get_all_pairs(self, els):
        return [(e1, e2) for (i1, e1) in enumerate(els) for (i2, e2) in enumerate(els) if i2 &gt; i1]
</code></pre></div></div> <footer> <div class=footer-buttons> <div class=previous><a href=../../myND/ title=myND><span>Previous</span></a></div> <div class=next><a href=../FOND/ title=FOND><span>Next</span></a></div> </div> <div class=footer-note> <p> Built with <a href=http://www.mkdocs.org>MkDocs</a> using <a href=https://github.com/daizutabi/mkdocs-ivory>Ivory theme</a>. </p> </div> </footer> </div> </main> </div> <script>var base_url = '../../../..';</script> <script src=../../../../js/theme.js></script> <script src=../../../../js/umlconvert.js></script> <script src=../../../../js/sequence-loader.js></script> <script src=https://unpkg.com/mermaid/dist/mermaid.min.js></script> <script src=https://cdnjs.cloudflare.com/ajax/libs/raphael/2.3.0/raphael.min.js></script> <script src=https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.12.0/underscore-min.js></script> <script src=https://cdnjs.cloudflare.com/ajax/libs/js-sequence-diagrams/1.0.6/sequence-diagram-min.js></script> <script src=https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.6.5/flowchart.min.js></script> <script src=../../../../search/main.js></script> </body> </html>