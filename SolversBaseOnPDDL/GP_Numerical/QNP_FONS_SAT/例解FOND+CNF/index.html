<!DOCTYPE html><html> <head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width, initial-scale=1.0"><meta name=author content=tridu33><link rel="shortcut icon" href=../../../../img/favicon.ico><title>例解FOND &mdash; AI Planning in PDDL-Descripted World</title><link rel=stylesheet href="//fonts.googleapis.com/css?family=Lato:400,700"><link rel=stylesheet href=//cdn.jsdelivr.net/gh/tonsky/FiraCode@1.206/distr/fira_code.css><link rel=stylesheet href=//use.fontawesome.com/releases/v5.8.1/css/all.css><link rel=stylesheet href=//use.fontawesome.com/releases/v5.8.1/css/v4-shims.css><link rel=stylesheet href=../../../../css/theme.css><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css><script src=//code.jquery.com/jquery-2.1.1.min.js></script><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js></script><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js></script><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/python.min.js></script><script>
        hljs.initHighlightingOnLoad();
    </script></head> <body ontouchstart> <div id=container> <aside> <div class=home> <div class=title> <button class=hamburger></button> <a href=../../../.. class=site-name> AI Planning in PDDL-Descripted World</a> </div> <div class=search> <div role=search> <form id=rtd-search-form class=wy-form action=../../../../search.html method=get> <input type=text name=q placeholder="Search docs" title="Type search term here"> </form> </div> </div> </div> <nav class=nav> <ul class=root> <li class=toctree-l1><a class=nav-item href=../../../..>Home</a><a class=nav-item href=../../../..>Home</a></li> <li class=toctree-l1><button class="section nav-item">规划界黑话</button> <ul class=subnav> <li class=toctree-l2><button class="section nav-item hide">PDDL进化史</button> <ul class="subnav hide"> <li class=toctree-l3><a href=../../../../PlanLanguages/ADL/ class=nav-item>ADL</a></li> <li class=toctree-l3><a href=../../../../PlanLanguages/STRIPS%E8%AF%AD%E8%A8%80/ class=nav-item>STRIPS</a></li> <li class=toctree-l3><button class="section nav-item hide">PDDL</button> <ul class="subnav hide"> <li class=toctree-l4><a href=../../../../PlanLanguages/PDDL%E8%AF%AD%E8%A8%80/ class=nav-item>HelloPDDL</a><a href=../../../../PlanLanguages/PDDL%E8%AF%AD%E8%A8%80/ class=nav-item>HelloPDDL</a></li> <li class=toctree-l4> <a href=../../../../PlanLanguages/version/ class=nav-item>版本迭代</a></li> <li class=toctree-l4><a href=../../../../PlanLanguages/Extension%20to%20PDDL%28SAS%29/ class=nav-item>PDDL扩展</a></li> </ul></li> </ul></li> <li class=toctree-l2><button class="section nav-item hide">机器人世界</button> <ul class="subnav hide"> <li class=toctree-l3><a href=../../../../PlanLanguages/Golog/Golog_ROS/ class=nav-item>Golog</a><a href=../../../../PlanLanguages/Golog/Golog_ROS/ class=nav-item>Golog</a><a href=../../../../PlanLanguages/Golog/Golog_ROS/ class=nav-item>Golog</a></li> </ul></li> </ul></li> <li class=toctree-l1><button class="section nav-item">PDDL使用</button> <ul class=subnav> <li class=toctree-l2> <a href=../../../../Usage/LocalSolvers/ class=nav-item>本地环境使用</a></li> <li class=toctree-l2> <a href=../../../../Usage/OnlineSolver/ class=nav-item>线上求解器使用</a></li> <li class=toctree-l2> <a href=../../../../Usage/VSCode/ class=nav-item>Visual Studio Code使用</a></li> <li class=toctree-l2><button class="section nav-item hide">经典demos</button> <ul class="subnav hide"> <li class=toctree-l3><a href=../../../%E5%88%8A%E7%89%A9%E4%B8%8A%E7%BB%8F%E5%85%B8demos/ class=nav-item>刊物上经典demos</a></li> <li class=toctree-l3><a href=../../../PDDL%20Benchmark%20Instances/ class=nav-item>BenchMark</a></li> </ul></li> </ul></li> <li class=toctree-l1><button class="section nav-item">PDDL语法</button> <ul class=subnav> <li class=toctree-l2> <a href=../../../../Syntax/PDDL%20axioms/ class=nav-item>语法总览</a></li> <li class=toctree-l2> <a href=../../../../Syntax/PDDLParser/ class=nav-item>Parser</a></li> </ul></li> <li class=toctree-l1><button class="section nav-item">PDDL-Descripted AI Planning World</button> <ul class=subnav> <li class=toctree-l2><button class="section nav-item hide">Papers</button> <ul class="subnav hide"> <li class=toctree-l3><a href=../../../../Papers/A%20review%20of%20generalized%20planning/ class=nav-item>reviewOfGP</a></li> <li class=toctree-l3><a href=../../../../Papers/GP_summary/ class=nav-item>GP_summary</a></li> <li class=toctree-l3><a href=../../../../Papers/A%20Review%20of%20Machine%20Learning%20for%20Automated%20Planning/ class=nav-item>ReviewOfMLforAP</a></li> <li class=toctree-l3><a href=../../../../Papers/Generalized%20Planning%20With%20Deep%20Reinforcement%20Learning/ class=nav-item>GPwithDeep-RL</a></li> <li class=toctree-l3><a href=../../../../Papers/Survey%20of%20research%20literature/ class=nav-item>researchSurvey</a></li> </ul></li> <li class="toctree-l2 current"><button class="section nav-item">SolversBaseOnPDDL</button> <ul class=subnav> <li class=toctree-l3><a href=../../../PyperPlan_STRIPS/ class=nav-item>PyperPlan_STRIPS</a></li> <li class=toctree-l3><a href=../../../Solvers/ class=nav-item>Solvers</a><a href=../../../Solvers/ class=nav-item>Solvers</a></li> <li class=toctree-l3><button class="section nav-item hide">CP</button> <ul class="subnav hide"> <li class=toctree-l4><a href=../../../CP/ffPlaner/ class=nav-item>FF</a></li> <li class=toctree-l4><a href=../../../CP/fast-downward/ class=nav-item>FD</a><a href=../../../CP/fast-downward/ class=nav-item>FD</a></li> <li class=toctree-l4><a href=../../../CP/LAPKT%E8%BD%BB%E9%87%8F%E8%87%AA%E5%8A%A8%E8%A7%84%E5%88%92%E5%B7%A5%E5%85%B7%E5%8C%85/ class=nav-item>LAPKT轻量自动规划工具包</a></li> </ul></li> <li class=toctree-l3><button class="section nav-item hide">GP_Numerical</button> <ul class="subnav hide"> <li class=toctree-l4> <a href=../../QNP_ReduceTo_GraphProblem/ class=nav-item>QNP_ReduceTo_GraphProblem</a></li> <li class=toctree-l4><a href=../../%E5%9B%BE%E6%B3%95QNP/ class=nav-item>图法QNP</a><a href=../../%E5%9B%BE%E6%B3%95QNP/ class=nav-item>图法QNP</a></li> <li class=toctree-l4><a href=../../LPG%EF%BC%88%E6%9C%AC%E5%9C%B0%E6%90%9C%E7%B4%A2%E8%A7%84%E5%88%92%E5%9B%BE%EF%BC%89/ class=nav-item>LPG</a></li> <li class=toctree-l4><a href=../../grahPlan/ class=nav-item>grahPlan</a></li> <li class=toctree-l4><a href=../../SGPlan6/ class=nav-item>SGPlan6</a><a href=../../SGPlan6/ class=nav-item>SGPlan6</a></li> <li class=toctree-l4><a href=../../PRP/ class=nav-item>PRP</a></li> <li class=toctree-l4><a href=../../myND/ class=nav-item>myND</a><a href=../../myND/ class=nav-item>myND</a><a href=../../myND/ class=nav-item>myND</a><a href=../../myND/ class=nav-item>myND</a></li> </ul></li> <li class="toctree-l3 current"><button class="section nav-item">QNP_FONS_SAT</button> <ul class=subnav> <li class=toctree-l4><a href=../CNF_py/ class=nav-item>CNF_py</a><a href=../CNF_py/ class=nav-item>CNF_py</a><a href=../CNF_py/ class=nav-item>CNF_py</a><a href=../CNF_py/ class=nav-item>CNF_py</a></li> <li class=toctree-l4><a href=../FOND/ class=nav-item>FOND</a><a href=../FOND/ class=nav-item>FOND</a><a href=../FOND/ class=nav-item>FOND</a><a href=../FOND/ class=nav-item>FOND</a><a href=../FOND/ class=nav-item>FOND</a><a href=../FOND/ class=nav-item>FOND</a><a href=../FOND/ class=nav-item>FOND</a><a href=../FOND/ class=nav-item>FOND</a></li> <li class=toctree-l4><a href=../QA_FOND/ class=nav-item>QA_FOND</a><a href=../QA_FOND/ class=nav-item>QA_FOND</a><a href=../QA_FOND/ class=nav-item>QA_FOND</a><a href=../QA_FOND/ class=nav-item>QA_FOND</a></li> <li class="toctree-l4 current"><a href=./ class="nav-item current">例解FOND</a><a href=./ class="nav-item current">例解FOND</a> <ul class=subnav> <li class=toctree-l5><a class="nav-item toc" href=#domainpddl>domain.pddl</a></li> <li class=toctree-l5><a class="nav-item toc" href=#sas>先生成sas文件</a></li> <li class=toctree-l5><a class="nav-item toc" href=#pparsersasmy_taskmy_task>然后p=Parser()读取sas文件生成my_task()对象my_task数据对象存储结构：</a></li> <li class=toctree-l5><a class="nav-item toc" href=#clauses-70-variables-26>Clauses = 70 Variables = 26</a></li> <li class=toctree-l5><a class="nav-item toc" href=#minisatcnfoutsat-temptx>通过调用minisat根据上cnf文件生成的outsat-temp.tx</a></li> <li class=toctree-l5><a class="nav-item toc" href=#_2>最终结果：</a></li> <li class=toctree-l5><a class="nav-item toc" href=#mainpy>main.py</a></li> <li class=toctree-l5><a class="nav-item toc" href=#args>替换args输入参数字典，直接输入我想要的字典，包括传进去的数值参数</a></li> <li class=toctree-l5><a class="nav-item toc" href=#domainpddltranslatepysas>使用domain文件和问题描述文件pddl通过translate.py生成翻译后的sas文件</a></li> <li class=toctree-l5><a class="nav-item toc" href=#parsermytask>在Parser类的方法中翻译成，保存成mytask类的数据：</a></li> <li class=toctree-l5><a class="nav-item toc" href=#_3>接下来这个大循环就是高潮部分：注意留意重点：</a></li> </ul></li> <li class=toctree-l4><a href=../QNP/ class=nav-item>QNP</a><a href=../QNP/ class=nav-item>QNP</a></li> <li class=toctree-l4><a href=../qnp2fond/ class=nav-item>qnp2fond</a></li> <li class=toctree-l4><a href=../QNP2SAT/ class=nav-item>QNP2SAT</a><a href=../QNP2SAT/ class=nav-item>QNP2SAT</a><a href=../QNP2SAT/ class=nav-item>QNP2SAT</a></li> </ul></li> </ul></li> <li class=toctree-l2><button class="section nav-item hide">PDDL-plan-validators</button> <ul class="subnav hide"> <li class=toctree-l3><a href=../../../../Extensions/PDDL-plan-validator/PDDL-plan-validator/ class=nav-item>validators</a></li> <li class=toctree-l3><a href=../../../../Extensions/PDDL-plan-validator/Lisp-pddl-INVAL-validator/ class=nav-item>INVAL</a></li> <li class=toctree-l3><a href=../../../../Extensions/PDDL-plan-validator/VScode-PDDL%E6%8F%92%E4%BB%B6VAL/ class=nav-item>VAL</a></li> </ul></li> <li class=toctree-l2><button class="section nav-item hide">PDDL-Auto Planning</button> <ul class="subnav hide"> <li class=toctree-l3><a href=../../../../Extensions/AP/PDDL4j_Java%20for%E8%87%AA%E5%8A%A8%E8%A7%84%E5%88%92/ class=nav-item>PDDL4j</a></li> <li class=toctree-l3><a href=../../../../Extensions/AP/Tarski%20-%20An%20AI%20Planning%20Modeling%20Framework/ class=nav-item>Tarski</a><a href=../../../../Extensions/AP/Tarski%20-%20An%20AI%20Planning%20Modeling%20Framework/ class=nav-item>Tarski</a></li> <li class=toctree-l3><a href=../../../../Extensions/AP/%E5%AE%9E%E4%BE%8B%E4%B8%AD%E5%AD%A6%E4%B9%A0QNP%E5%AE%9A%E4%B9%89%E5%AE%9E%E7%8E%B0AP%28AutomatedPlanning%29/ class=nav-item>QNP2AP</a></li> <li class=toctree-l3><a href=../../../../Extensions/RL/PDDLGYM/ class=nav-item>PDDLGYM</a><a href=../../../../Extensions/RL/PDDLGYM/ class=nav-item>PDDLGYM</a></li> <li class=toctree-l3><a href=../../../../Extensions/RL/RLPlanPapers/ class=nav-item>PDDL+RL强化学习</a></li> </ul></li> </ul></li> <li class=toctree-l1><button class="section nav-item">进击的PDDL</button> <ul class=subnav> <li class=toctree-l2><button class="section nav-item hide">Curry-Howard correspondence</button> <ul class="subnav hide"> <li class=toctree-l3><a href=../../../../FurtherMore/%E6%8E%A7%E5%88%B6%E6%B5%81%E5%9B%BECFG%E8%AF%AD%E4%B9%89%E7%BD%91%E7%BB%9Cpetri%E8%BF%81%E7%A7%BB%E7%B3%BB%E7%BB%9F%E6%89%A9%E5%B1%95%E5%BA%94%E7%94%A8/ class=nav-item>CFG语义网络</a></li> <li class=toctree-l3><a href=../../../../FurtherMore/PDDL-Solver2AST/ class=nav-item>PDDL-Solver2AST</a></li> <li class=toctree-l3><a href=../../../../FurtherMore/TransitionSystemModelCheck/ class=nav-item>CFG=TransitionSystemModelCheck.md</a></li> <li class=toctree-l3><a href=../../../../FurtherMore/qnp2ast2program/ class=nav-item>qnp2ast2program</a></li> </ul></li> </ul></li> <li class=toctree-l1> <a class=nav-item href=https://github.com/Tridu33/ZERO-Starting-AI-Planning-in-PDDL-Descripted-World/issues>Issue跟踪讨论</a></li> </ul> </nav> <div class=repo> <div class=link> </div> <div class=previous><a href=../QA_FOND/ >&laquo; Previous</a></div> <div class=next><a href=../QNP/ >Next &raquo;</a></div> </div> </aside> <div id=spacer><button class=arrow></button></div> <main> <div class=home-top> <button class=hamburger></button> <a href=../../../.. class=site-name> AI Planning in PDDL-Descripted World</a> </div> <div id=main> <nav class=breadcrumbs> <ul> <li>PDDL-Descripted AI Planning World &raquo; </li><li>SolversBaseOnPDDL &raquo; </li><li>QNP_FONS_SAT</li> </ul> </nav> <div id=content><div class=toc> <ul> <li><a href=#stupid>stupid</a><ul> <li><a href=#domainpddl>domain.pddl</a></li> <li><a href=#sas>先生成sas文件</a></li> <li><a href=#pparsersasmy_taskmy_task>然后p=Parser()读取sas文件生成my_task()对象my_task数据对象存储结构：</a></li> <li><a href=#clauses-70-variables-26>Clauses = 70 Variables = 26</a></li> <li><a href=#minisatcnfoutsat-temptx>通过调用minisat根据上cnf文件生成的outsat-temp.tx</a><ul> <li><a href=#_1>公式映射</a></li> </ul> </li> <li><a href=#_2>最终结果：</a></li> </ul> </li> <li><a href=#stupid-road-demo-run-in-ipythonjupyter>我的stupid road demo run in Ipython/Jupyter</a><ul> <li><a href=#mainpy>main.py</a></li> <li><a href=#args>替换args输入参数字典，直接输入我想要的字典，包括传进去的数值参数</a></li> <li><a href=#domainpddltranslatepysas>使用domain文件和问题描述文件pddl通过translate.py生成翻译后的sas文件</a></li> <li><a href=#parsermytask>在Parser类的方法中翻译成，保存成mytask类的数据：</a></li> <li><a href=#_3>接下来这个大循环就是高潮部分：注意留意重点：</a></li> </ul> </li> </ul> </div> <h1 id=stupid>stupid<a class=headerlink href=#stupid title="Permanent link">&para;</a></h1> <h2 id=domainpddl>domain.pddl<a class=headerlink href=#domainpddl title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code>(define (problem line-0)
(:domain line)
(:objects 
    L1 - location
    L2 - location
)
(:init
    (person-at L1)

    (road L1 L2)
    (road L2 L1)
)
(:goal (person-at L2))
)
</code></pre></div> <p>problem 2 grid move right</p> <div class=highlight><pre><span></span><code>; Stupid Examples for me to understand this programe 

(define (domain line)
  (:requirements :typing)
  (:types location)
  (:predicates (person-at ?loc - location)
               (road ?from - location ?to - location)
  )            
  (:action move
  ;move动作命名为move才合理。一开始例子没写好，反正后续“move”都理解为move就好。前提约束好像也有点小问题，但是不影响后续理解，就懒得改动了。
    :parameters (?from - location ?to - location)
    :precondition (and (person-at ?from) (road ?from ?to))
    :effect (and (person-at ?to) (not (person-at ?from)))
  )
)
</code></pre></div> <p><div class=highlight><pre><span></span><code>/src$ python  main.py ../mystupidroad/domain.pddl  ../mystupidroad/stupid.pddl -strong 1 -policy 1
</code></pre></div> 中间文件：</p> <h2 id=sas>先生成sas文件<a class=headerlink href=#sas title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code>begin_version
3
end_version
begin_metric
0
end_metric
1
begin_variable
var0
-1
2
Atom person-at(l1)
Atom person-at(l2)
end_variable
1
begin_mutex_group
2
0 0
0 1
end_mutex_group
begin_state
0
end_state
begin_goal
1
0 1
end_goal
2
begin_operator
move l1 l2
0
1
0 0 0 1
0
end_operator
begin_operator
move l2 l1
0
1
0 0 1 0
0
end_operator
0
</code></pre></div> <h2 id=pparsersasmy_taskmy_task>然后p=Parser()读取sas文件生成my_task()对象my_task数据对象存储结构：<a class=headerlink href=#pparsersasmy_taskmy_task title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code>&gt;&gt;&gt; my_task.print_task()
ATOMS ================================================
(var0=1)
(var0=0)
INITIAL ==============================================
(var0=0)
GOAL =================================================
(var0=1)
ACTIONS ==============================================
(&#39;move(l1,l2)&#39;, [])
(&#39;move(l1,l2)&#39;, [[&#39;(var0=0)&#39;], [&#39;(var0=1)&#39;], [&#39;(var0=0)&#39;]])
(&#39;move(l2,l1)&#39;, [])
(&#39;move(l2,l1)&#39;, [[&#39;(var0=1)&#39;], [&#39;(var0=0)&#39;], [&#39;(var0=1)&#39;]])
&gt;&gt;&gt; print(my_task.action_nondet)
{&#39;move(l1,l2)&#39;: [], &#39;move(l2,l1)&#39;: []}
&gt;&gt;&gt; print(my_task.action_cardinality)
{&#39;move&#39;: 1, &#39;move(l1,l2)&#39;: 1, &#39;move(l2,l1)&#39;: 1}
&gt;&gt;&gt; print(my_task.mutex_groups)
[[&#39;(var0=0)&#39;, &#39;(var0=1)&#39;]]
&gt;&gt;&gt; print(my_task.compatible_actions)
{&#39;move(l1,l2)&#39;: set([]), &#39;move(l2,l1)&#39;: set([])}
&gt;&gt;&gt; print(my_task.mutex_groups_set)
[set([&#39;(var0=1)&#39;, &#39;(var0=0)&#39;])]
&gt;&gt;&gt; print(my_task.relevant_actions_atom)
{&#39;(var0=1)&#39;: set([&#39;move(l1,l2)&#39;, &#39;move(l2,l1)&#39;]), &#39;(var0=0)&#39;: set([&#39;move(l1,l2)&#39;, &#39;move(l2,l1)&#39;])}
&gt;&gt;&gt; print(my_task.relevant_actions_atom_aname)
{}
&gt;&gt;&gt; print(my_task.action_names)
set([&#39;move&#39;])
&gt;&gt;&gt; print(my_task.other_actions_name)
{&#39;move&#39;: []}
&gt;&gt;&gt; print(my_task.action_name_to_actions)
{&#39;move&#39;: [&#39;move(l1,l2)&#39;, &#39;move(l2,l1)&#39;]}
</code></pre></div> <h2 id=clauses-70-variables-26>Clauses = 70 Variables = 26<a class=headerlink href=#clauses-70-variables-26 title="Permanent link">&para;</a></h2> <p>实际的输出中：</p> <div class=highlight><pre><span></span><code>SAT formula generation time = 0.000351
# Clauses = 70
# Variables = 26
</code></pre></div> <p>然后在cnf=CNF类的对象输入my_task数据,</p> <p>main.py大循环就是高潮部分：留意重点：</p> <div class=highlight><pre><span></span><code>solver_time = []
for i in range(1000):
    cnf = CNF(name_formula_file, name_formula_file_extra, fair, strong)#文件formula-temp.txt这时候是空白的，formula-extra-temp此时空白，仅仅是传入地址方便最终结果存入数据
    ......
    cnf.reset()
    start_g = timer()
    cnf.generate_clauses(my_task, &#39;n0&#39;, &#39;ng&#39;, controllerStates, len(controllerStates), p, show_gen_info)#生成子句Clauses和写入cnf文件合取范式的核心代码!!!
传入字符&#39;n0&#39;, 终态&#39;ng&#39;
&gt;&gt;&gt; print(controllerStates)
[&#39;n0&#39;, &#39;n1&#39;, &#39;ng&#39;]这个是3格的情况，2格的时候是[&#39;n0&#39;,&#39;ng&#39;]
&gt;&gt;&gt; len(controllerStates)
3
&gt;&gt;&gt; print(show_gen_info)
False懒得显示这部分，因为和我要关心的重点没关系
这里的p是Parser实例，可能用里面的方法，因为基本看着都是私有变量
    ......
    command = &#39;./minisat %s %s&#39; % (name_formula_file, name_output_satsolver)#调用minisat
    ......
    result = cnf.parseOutput(name_output_satsolver, controllerStates, p, print_policy)#读取文件name_output_satsolver : outsat-temp.txt输出结果
    ......
</code></pre></div> <p>生成Fomula-temp.txt，和formula-temp.txtheader唯一区别第一行，cnf 1,1。里面保存着所有Clause的cnf格式合取范式公式编号，符号正负应该代表对应子式Clauses正负文字，</p> <p>26Variables生成70Clauses的cnf文件</p> <p>Variables 26</p> <div class=highlight><pre><span></span><code>&gt;&gt;&gt; cnf.printVariables()
reachableG(ng,0)
(ng,move,n0)
(ng,move(l1,l2))
reachableI(n0)
(n0,move)
(ng,move(l2,l1))
(n0,move,ng)
(ng,move,ng)
reachableI(ng)
reachableG(n0,0)
(var0=0)(n0)
(ng,move)
(n0,n0)
reachableG(ng,1)
YR1-n0-n0-0
(ng,n0)
(var0=0)(ng)
YR1-n0-ng-0
(var0=1)(n0)
(n0,move(l2,l1))
(ng,ng)
(n0,ng)
(n0,move,n0)
(var0=1)(ng)
(n0,move(l1,l2))
reachableG(n0,1)
</code></pre></div> <div class=highlight><pre><span></span><code>p cnf 1 1
-1  0
2   0
-3  4   0
-5  1   0
-6  7   0
-8  2   0
-11 -12 0
-12 -11 0
-3  9   0
-5  9   0
-9  11  12  0
-9  3   5   0
-13 -14 0
-14 -13 0
-6  10  0
-8  10  0
-10 13  14  0
-10 6   8   0
-11 9   0
-12 9   0
-13 10  0
-14 10  0
9   0
-11 -5  -1  0
-15 1   -1  3   0
-11 -3  -4  0
-15 4   -4  5   0
-12 -5  -2  0
-16 1   -2  3   0
-12 -3  -7  0
-16 4   -7  5   0
-13 -8  -1  0
-17 2   -1  6   0
-13 -6  -4  0
-17 7   -4  8   0
-14 -8  -2  0
-18 2   -2  6   0
-14 -6  -7  0
-18 7   -7  8   0
-11 15  0
-15 11  0
-12 16  0
-16 12  0
-13 17  0
-17 13  0
-14 18  0
-18 14  0
19  0
-15 -19 19  0
-16 -19 20  0
-17 -20 19  0
-18 -20 20  0
-19 21  0
-20 22  0
23  0
22  0
-24 0
-24 21  0
-23 22  0
-25 -15 24  0
-24 25  0
15  25  0
-26 -16 23  0
-23 26  0
16  26  0
-21 25  0
-21 26  0
21  -25 -26 0
-4  -1  0
-7  -2  0
</code></pre></div> <p>对应命题cnf就是Clauses 70</p> <div class=highlight><pre><span></span><code>p cnf 1 1
&#39;(var0=1)(n0)&#39;  0
&#39;(var0=1)(ng)&#39;  0
负&#39;(n0,move(l1,l2))&#39; &#39;(var0=0)(n0)&#39;  0
负&#39;(n0,move(l2,l1))&#39; &#39;(var0=1)(n0)&#39;  0
负&#39;(ng,move(l1,l2))&#39; &#39;(var0=0)(ng)&#39;  0
负&#39;(ng,move(l2,l1))&#39; &#39;(var0=1)(ng)&#39;  0
负&#39;(n0,move,n0)&#39; 负&#39;(n0,move,ng)&#39; 0
负&#39;(n0,move,ng)&#39; 负&#39;(n0,move,n0)&#39; 0
负&#39;(n0,move(l1,l2))&#39; &#39;(n0,move)&#39; 0
负&#39;(n0,move(l2,l1))&#39; &#39;(n0,move)&#39; 0
负&#39;(n0,move)&#39;    &#39;(n0,move,n0)&#39;  &#39;(n0,move,ng)&#39;  0
负&#39;(n0,move)&#39;    &#39;(n0,move(l1,l2))&#39;  &#39;(n0,move(l2,l1))&#39;  0
负&#39;(ng,move,n0)&#39; 负&#39;(ng,move,ng)&#39; 0
负&#39;(ng,move,ng)&#39; 负&#39;(ng,move,n0)&#39; 0
负&#39;(ng,move(l1,l2))&#39; &#39;(ng,move)&#39; 0
负&#39;(ng,move(l2,l1))&#39; &#39;(ng,move)&#39; 0
负&#39;(ng,move)&#39;    &#39;(ng,move,n0)&#39;  &#39;(ng,move,ng)&#39;  0
负&#39;(ng,move)&#39;    &#39;(ng,move(l1,l2))&#39;  &#39;(ng,move(l2,l1))&#39;  0
负&#39;(n0,move,n0)&#39; &#39;(n0,move)&#39; 0
负&#39;(n0,move,ng)&#39; &#39;(n0,move)&#39; 0
负&#39;(ng,move,n0)&#39; &#39;(ng,move)&#39; 0
负&#39;(ng,move,ng)&#39; &#39;(ng,move)&#39; 0
&#39;(n0,move)&#39; 0
负&#39;(n0,move,n0)&#39; 负&#39;(n0,move(l2,l1))&#39; &#39;(var0=1)(n0)&#39;  0
负&#39;(n0,n0)&#39;  &#39;(var0=1)(n0)&#39;  &#39;(var0=1)(n0)&#39;  &#39;(n0,move(l1,l2))&#39;  0
负&#39;(n0,move,n0)&#39; 负&#39;(n0,move(l1,l2))&#39; 负&#39;(var0=0)(n0)&#39; 0
负&#39;(n0,n0)&#39;  &#39;(var0=0)(n0)&#39;  负&#39;(var0=0)(n0)&#39; &#39;(n0,move(l2,l1))&#39;  0
负&#39;(n0,move,ng)&#39; 负&#39;(n0,move(l2,l1))&#39; 负&#39;(var0=1)(ng)&#39; 0
负&#39;(n0,ng)&#39;  &#39;(var0=1)(n0)&#39;  负&#39;(var0=1)(ng)&#39; &#39;(n0,move(l1,l2))&#39;  0
负&#39;(n0,move,ng)&#39; 负&#39;(n0,move(l1,l2))&#39; 负&#39;(var0=0)(ng)&#39; 0
负&#39;(n0,ng)&#39;  &#39;(var0=0)(n0)&#39;  负&#39;(var0=0)(ng)&#39; &#39;(n0,move(l2,l1))&#39;  0
负&#39;(ng,move,n0)&#39; 负&#39;(ng,move(l2,l1))&#39; &#39;(var0=1)(n0)&#39;  0
负&#39;(ng,n0)&#39;  &#39;(var0=1)(ng)&#39;  &#39;(var0=1)(n0)&#39;  &#39;(ng,move(l1,l2))&#39;  0
负&#39;(ng,move,n0)&#39; 负&#39;(ng,move(l1,l2))&#39; 负&#39;(var0=0)(n0)&#39; 0
负&#39;(ng,n0)&#39;  &#39;(var0=0)(ng)&#39;  负&#39;(var0=0)(n0)&#39; &#39;(ng,move(l2,l1))&#39;  0
负&#39;(ng,move,ng)&#39; 负&#39;(ng,move(l2,l1))&#39; 负&#39;(var0=1)(ng)&#39; 0
负&#39;(ng,ng)&#39;  &#39;(var0=1)(ng)&#39;  负&#39;(var0=1)(ng)&#39; &#39;(ng,move(l1,l2))&#39;  0
负&#39;(ng,move,ng)&#39; 负&#39;(ng,move(l1,l2))&#39; 负&#39;(var0=0)(ng)&#39; 0
负&#39;(ng,ng)&#39;  &#39;(var0=0)(ng)&#39;  负&#39;(var0=0)(ng)&#39; &#39;(ng,move(l2,l1))&#39;  0
负&#39;(n0,move,n0)&#39; &#39;(n0,n0)&#39;   0
负&#39;(n0,n0)&#39;  &#39;(n0,move,n0)&#39;  0
负&#39;(n0,move,ng)&#39; &#39;(n0,ng)&#39;   0
负&#39;(n0,ng)&#39;  &#39;(n0,move,ng)&#39;  0
负&#39;(ng,move,n0)&#39; &#39;(ng,n0)&#39;   0
负&#39;(ng,n0)&#39;  &#39;(ng,move,n0)&#39;  0
负&#39;(ng,move,ng)&#39; &#39;(ng,ng)&#39;   0
负&#39;(ng,ng)&#39;  &#39;(ng,move,ng)&#39;  0
&#39;reachableI(n0)&#39;    0
负&#39;(n0,n0)&#39;  负&#39;reachableI(n0)&#39;   &#39;reachableI(n0)&#39;    0
负&#39;(n0,ng)&#39;  负&#39;reachableI(n0)&#39;   &#39;reachableI(ng)&#39;    0
负&#39;(ng,n0)&#39;  负&#39;reachableI(ng)&#39;   &#39;reachableI(n0)&#39;    0
负&#39;(ng,ng)&#39;  负&#39;reachableI(ng)&#39;   &#39;reachableI(ng)&#39;    0
负&#39;reachableI(n0)&#39;   &#39;reachableG(n0,1)&#39;  0
负&#39;reachableI(ng)&#39;   &#39;reachableG(ng,1)&#39;  0
&#39;reachableG(ng,0)&#39;  0
&#39;reachableG(ng,1)&#39;  0
负&#39;reachableG(n0,0)&#39; 0
负&#39;reachableG(n0,0)&#39; &#39;reachableG(n0,1)&#39;  0
负&#39;reachableG(ng,0)&#39; &#39;reachableG(ng,1)&#39;  0
负&#39;YR1-n0-n0-0&#39;  负&#39;(n0,n0)&#39;  &#39;reachableG(n0,0)&#39;  0
负&#39;reachableG(n0,0)&#39; &#39;YR1-n0-n0-0&#39;   0
&#39;(n0,n0)&#39;   &#39;YR1-n0-n0-0&#39;   0
负&#39;YR1-n0-ng-0&#39;  负&#39;(n0,ng)&#39;  &#39;reachableG(ng,0)&#39;  0
负&#39;reachableG(ng,0)&#39; &#39;YR1-n0-ng-0&#39;   0
&#39;(n0,ng)&#39;   &#39;YR1-n0-ng-0&#39;   0
负&#39;reachableG(n0,1)&#39; &#39;YR1-n0-n0-0&#39;   0
负&#39;reachableG(n0,1)&#39; &#39;YR1-n0-ng-0&#39;   0
&#39;reachableG(n0,1)&#39;  负&#39;YR1-n0-n0-0&#39;  负&#39;YR1-n0-ng-0&#39;  0
负&#39;(var0=0)(n0)&#39; &#39;(var0=1)(n0)&#39;  0
负&#39;(var0=0)(ng)&#39; 负&#39;(var0=1)(ng)&#39; 0
</code></pre></div> <p>cnf.py</p> <div class=highlight><pre><span></span><code>    ###########################################
    ############## GENERATION #################
    ###########################################

    #def generate_clauses(self, task, initialCState, goalCState, controllerStates, k, parser = None, debug = False):
    def generate_clauses(self, task, initialCState, goalCState, controllerStates, k, parser = None, debug = True):
        self.generateInitial(task, initialCState, debug)
        self.generateGoal(task, goalCState, debug)
        self.generatePreconditions(task, controllerStates, debug)
        self.generatePossibleNonDet(task, controllerStates, debug)
        self.generateOneSuccessor(task, controllerStates, debug)
        self.generateTripletForcesBin(task, controllerStates, debug)
        self.generateAtLeastOneAction(task, controllerStates, debug)
        self.generateNegativeForwardPropagation(task, controllerStates, debug)
        self.generateGeneralizeConnection(task, controllerStates, debug)
        self.generateReachableIClauses(task, initialCState, controllerStates, k, debug)
        self.generateReachableGClauses(task, controllerStates, goalCState, k, debug)
        self.generateSymmetryBreaking(task, controllerStates, initialCState, goalCState, debug)
        self.generateMutexGroupsClauses(task, controllerStates, debug)
</code></pre></div> <p>### cnf.26Variables &rarr; 70Clauses</p> <p>对应的子句生成如下所示：</p> <div class=highlight><pre><span></span><code>&gt;&gt;&gt; cnf.reset()
p cnf 1 1
&gt;&gt;&gt; start_g = timer()
&gt;&gt;&gt; task=my_task
&gt;&gt;&gt; initialCState=&#39;n0&#39;
&gt;&gt;&gt; goalCState=&#39;ng&#39;
&gt;&gt;&gt; debug=True
&gt;&gt;&gt; k=len(controllerStates)
</code></pre></div> <div class=highlight><pre><span></span><code>self.generateInitial(task, initialCState, debug)
# -p(n0) for all p not in initial state
</code></pre></div> <p>结果</p> <div class=highlight><pre><span></span><code>&gt;&gt;&gt; cnf.generateInitial(task, initialCState, debug)
-1  0
负&#39;(var0=1)(n0)&#39; 0
Generation: Initial              v 1             c : 1           0.000241
</code></pre></div> <div class=highlight><pre><span></span><code>self.generateGoal(task, goalCState, debug)
# p(ng) for all p in goal state
</code></pre></div> <p>结果</p> <div class=highlight><pre><span></span><code>&gt;&gt;&gt; cnf.generateGoal(task, goalCState, debug)
2   0
&#39;(var0=1)(ng)&#39;  0
Generation: Goal                 v 1             c : 1           0.000200
</code></pre></div> <div class=highlight><pre><span></span><code>self.generatePreconditions(task, controllerStates, debug)
# p(ng) for all p in goal state
</code></pre></div> <p>结果</p> <div class=highlight><pre><span></span><code>&gt;&gt;&gt; cnf.generatePreconditions(task, controllerStates, debug)
-3  4   0
-5  1   0
-6  7   0
-8  2   0
负&#39;(n0,move(l1,l2))&#39;     &#39;(var0=0)(n0)&#39;  0
负&#39;(n0,move(l2,l1))&#39;     1   0
负&#39;(ng,move(l1,l2))&#39; &#39;(var0=0)(ng)&#39;  0
负&#39;(ng,move(l2,l1))&#39; &#39;(var0=1)(ng)&#39;  0
</code></pre></div> <p><div class=highlight><pre><span></span><code>self.generatePossibleNonDet(task, controllerStates, debug)
# 1. (n, act) --&gt; (n, act&#39;) // act, act&#39; are non det act of equal det action (action names)
# 2. (n, act) --&gt; -(n, act&#39;&#39;) //
# 3. (n, b) --&gt; (n, b&#39;) // b, b&#39; are siblings
# 4. (n, b) --&gt; -(n, b&#39;&#39;) // b, b&#39;&#39; belong to same act
</code></pre></div> 结果</p> <div class=highlight><pre><span></span><code>&gt;&gt;&gt; cnf.generatePossibleNonDet(task, controllerStates, debug)
Generation: Non Det              v 2             c : 0           0.000035
</code></pre></div> <div class=highlight><pre><span></span><code>self.generateOneSuccessor(task, controllerStates, debug)
# 1. (n, act) --&gt; \OR_{b} (n, b) // for b with name act
# 2. (n, act) --&gt; \OR_{n&#39;} (n, act, n&#39;)
# 3. -(n, act, n&#39;) \lor -(n, act, n&#39;&#39;)
# 4. (n, b) --&gt; (n, act)
</code></pre></div> <p>结果</p> <div class=highlight><pre><span></span><code>&gt;&gt;&gt; cnf.generateOneSuccessor(task, controllerStates, debug)
-11 -12 0
-12 -11 0
-3  9   0
-5  9   0
-9  11  12  0
-9  3   5   0
-13 -14 0
-14 -13 0
-6  10  0
-8  10  0
-10 13  14  0
-10 6   8   0
负&#39;(n0,move,n0)&#39;     负&#39;(n0,move,ng)&#39;     0
负&#39;(n0,move,ng)&#39;     负&#39;(n0,move,n0)&#39;     0
负&#39;(n0,move(l1,l2))&#39;     &#39;(n0,move)&#39; 0
负&#39;(n0,move(l2,l1))&#39;     &#39;(n0,move)&#39; 0
负&#39;(n0,move)&#39;    &#39;(n0,move,n0)&#39;  &#39;(n0,move,ng)&#39;  0
负&#39;(n0,move)&#39;    &#39;(n0,move(l1,l2))&#39;  &#39;(n0,move(l2,l1))&#39;  0
负&#39;(ng,move,n0)&#39; 负&#39;(ng,move,ng)&#39; 0
负&#39;(ng,move,ng)&#39; 负&#39;(ng,move,n0)&#39; 0
负&#39;(ng,move(l1,l2))&#39; &#39;(ng,move)&#39;     0
负&#39;(ng,move(l2,l1))&#39; &#39;(ng,move)&#39;     0
负&#39;(ng,move)&#39;    &#39;(ng,move,n0)&#39;  &#39;(ng,move,ng)&#39;  0
负&#39;(ng,move)&#39;    &#39;(ng,move(l1,l2))&#39;  &#39;(ng,move(l2,l1))&#39;  0
Generation: One succ             v 4             c : 12                  0.085124
</code></pre></div> <div class=highlight><pre><span></span><code>self.generateTripletForcesBin(task, controllerStates, debug)
# (n, act, n&#39;) --&gt; (n, act)
</code></pre></div> <p>结果</p> <div class=highlight><pre><span></span><code>&gt;&gt;&gt; cnf.generateTripletForcesBin(task, controllerStates, debug)
-11 9   0
-12 9   0
-13 10  0
-14 10  0
负&#39;(n0,move,n0)&#39;     &#39;(n0,move)&#39; 0
负&#39;(n0,move,ng)&#39;     &#39;(n0,move)&#39; 0
负&#39;(ng,move,n0)&#39; &#39;(ng,move)&#39;     0
负&#39;(ng,move,ng)&#39; &#39;(ng,move)&#39;     0
Generation: Trip bin             v 0             c : 4           0.030731
</code></pre></div> <div class=highlight><pre><span></span><code>self.generateAtLeastOneAction(task, controllerStates, debug)
# \OR_{act_name} (n, act) for all n except goal, ng
</code></pre></div> <p>结果</p> <div class=highlight><pre><span></span><code>&gt;&gt;&gt; cnf.generateAtLeastOneAction(task, controllerStates, debug)
9   0
&#39;(n0,move)&#39; 0
Generation: One act              v 0             c : 1           0.005008
</code></pre></div> <div class=highlight><pre><span></span><code>self.generateNegativeForwardPropagation(task, controllerStates, debug)
# 1. (n, act, n&#39;) \land (n, b) --&gt; -p(n&#39;) // if p in delete list
# 2. (n, n&#39;) \land -p(n) --&gt; -p(n&#39;) \lor \OR_{b: p \in add(b)} (n, b)
# 3. (n, act, n&#39;) \land (n, b) \land -p(n) --&gt; -p(n&#39;) // if p \not \in add(b) 
# and some sibling of b adds p
# for a in actions:
#   print(a, task.get_del_list(a))
#   print(a, task.get_add_list(a))
</code></pre></div> <p>2.(n, n') <span class=arithmatex>\(\land\)</span> -p(n) &rarr; -p(n') <span class=arithmatex>\(\lor\)</span> <span class=arithmatex>\(\lor_{b: p \in add(b)}\)</span> （n,b） 结果</p> <div class=highlight><pre><span></span><code>&gt;&gt;&gt; cnf.generateNegativeForwardPropagation(task, controllerStates, debug)
-11 -5  -1  0
-15 1   -1  3   0
-11 -3  -4  0
-15 4   -4  5   0
-12 -5  -2  0
-16 1   -2  3   0
-12 -3  -7  0
-16 4   -7  5   0
-13 -8  -1  0
-17 2   -1  6   0
-13 -6  -4  0
-17 7   -4  8   0
-14 -8  -2  0
-18 2   -2  6   0
-14 -6  -7  0
-18 7   -7  8   0
负&#39;(n0,move,n0)&#39;     负&#39;(n0,move(l2,l1))&#39;     负&#39;(var0=1)(n0)&#39; 0
负&#39;(n0,n0)&#39;  &#39;(var0=1)(n0)&#39;  负&#39;(var0=1)(n0)&#39; &#39;(n0,move(l1,l2))&#39;  0
负&#39;(n0,move,n0)&#39;     负&#39;(n0,move(l1,l2))&#39;     负&#39;(var0=0)(n0)&#39; 0
负&#39;(n0,n0)&#39;  &#39;(var0=0)(n0)&#39;  负&#39;(var0=0)(n0)&#39; &#39;(n0,move(l2,l1))&#39;  0
负&#39;(n0,move,ng)&#39;     负&#39;(n0,move(l2,l1))&#39;     负&#39;(var0=1)(ng)&#39;     0
负&#39;(n0,ng)&#39;  &#39;(var0=1)(n0)&#39;  负&#39;(var0=1)(ng)&#39;     &#39;(n0,move(l1,l2))&#39;  0
负&#39;(n0,move,ng)&#39;     负&#39;(n0,move(l1,l2))&#39;     负&#39;(var0=0)(ng)&#39; 0
负&#39;(n0,ng)&#39;  &#39;(var0=0)(n0)&#39;  负&#39;(var0=0)(ng)&#39; &#39;(n0,move(l2,l1))&#39;  0
负&#39;(ng,move,n0)&#39; 负&#39;(ng,move(l2,l1))&#39; 负&#39;(var0=1)(n0)&#39; 0
负&#39;(ng,n0)&#39;  &#39;(var0=1)(ng)&#39;  负&#39;(var0=1)(n0)&#39; &#39;(ng,move(l1,l2))&#39;  0
负&#39;(ng,move,n0)&#39; 负&#39;(ng,move(l1,l2))&#39; 负&#39;(var0=0)(n0)&#39; 0
负&#39;(ng,n0)&#39;  &#39;(var0=0)(ng)&#39;  负&#39;(var0=0)(n0)&#39; &#39;(ng,move(l2,l1))&#39;  0
负&#39;(ng,move,ng)&#39; 负&#39;(ng,move(l2,l1))&#39; 负&#39;(var0=1)(ng)&#39;     0
负&#39;(ng,ng)&#39;  &#39;(var0=1)(ng)&#39;  负&#39;(var0=1)(ng)&#39;     &#39;(ng,move(l1,l2))&#39;  0
负&#39;(ng,move,ng)&#39; 负&#39;(ng,move(l1,l2))&#39; 负&#39;(var0=0)(ng)&#39; 0
负&#39;(ng,ng)&#39;  &#39;(var0=0)(ng)&#39;  负&#39;(var0=0)(ng)&#39; &#39;(ng,move(l2,l1))&#39;  0
Generation: Neg Prop             v 4             c : 16                  0.135173
</code></pre></div> <div class=highlight><pre><span></span><code>self.generateGeneralizeConnection(task, controllerStates, debug)
# (n, n&#39;) &lt;--&gt; \OR_{act} (n, act, n&#39;)
</code></pre></div> <p>结果</p> <div class=highlight><pre><span></span><code>&gt;&gt;&gt; cnf.generateGeneralizeConnection(task, controllerStates, debug)
-11 15  0
-15 11  0
-12 16  0
-16 12  0
-13 17  0
-17 13  0
-14 18  0
-18 14  0
负&#39;(n0,move,n0)&#39;     &#39;(n0,n0)&#39;   0
负&#39;(n0,n0)&#39;  &#39;(n0,move,n0)&#39;  0
负&#39;(n0,move,ng)&#39;     &#39;(n0,ng)&#39;   0
负&#39;(n0,ng)&#39;  &#39;(n0,move,ng)&#39;  0
负&#39;(ng,move,n0)&#39; &#39;(ng,n0)&#39;   0
负&#39;(ng,n0)&#39;  &#39;(ng,move,n0)&#39;  0
负&#39;(ng,move,ng)&#39; &#39;(ng,ng)&#39;   0
负&#39;(ng,ng)&#39;  &#39;(ng,move,ng)&#39;  0
Generation: Gen conn             v 0             c : 8           0.048381
</code></pre></div> <p><div class=highlight><pre><span></span><code>self.generateReachableIClauses(task, initialCState, controllerStates, k, debug)
</code></pre></div> 结果</p> <div class=highlight><pre><span></span><code>&gt;&gt;&gt; cnf.generateReachableIClauses(task, initialCState, controllerStates, k, debug)
19  0
&#39;reachableI(n0)&#39;    0
Generation: RI init              v 1             c : 1           0.005257
-15 -19 19  0
-16 -19 20  0
-17 -20 19  0
-18 -20 20  0
负&#39;(n0,n0)&#39;  负&#39;reachableI(n0)&#39;   &#39;reachableI(n0)&#39;    0
负&#39;(n0,ng)&#39;  负&#39;reachableI(n0)&#39;   &#39;reachableI(ng)&#39;    0
负&#39;(ng,n0)&#39;  负&#39;reachableI(ng)&#39;   &#39;reachableI(n0)&#39;    0
负&#39;(ng,ng)&#39;  负&#39;reachableI(ng)&#39;   &#39;reachableI(ng)&#39;    0
Generation: RI prop              v 1             c : 4           0.030447
-19 21  0
-20 22  0
负&#39;reachableI(n0)&#39;   &#39;reachableG(n0,1)&#39;  0
负&#39;reachableI(ng)&#39;   &#39;reachableG(ng,1)&#39;  0
Generation: IG prop              v 2             c : 2           0.007711
</code></pre></div> <div class=highlight><pre><span></span><code>self.generateReachableGClauses(task, controllerStates, goalCState, k, debug)
        def generateReachableGClauses(self, task, controllerStates, goalCState, k, debug = True):
            self.generateReachableGInitial(task, goalCState, controllerStates, k - 1, debug)
            # ReachG(ng,0), ReachG(ng,1), ...
            # -ReachG(n, 0) for n != ng
            # set the initial values for goal state
            # set the negation for non goal states
            self.generateCompletionReachabilityG(task, controllerStates, k - 1, debug)
            # ReachG(n,j) --&gt; ReachG(n, j+1)
            if self.strong:
                self.generatePropagationReachableGStrong(task, controllerStates, k - 1, debug)
                # ReachG(n, j+1) &lt;--&gt; \AND_{n&#39;} [(n,n&#39;) --&gt; ReachG(n&#39;, j)]
                # Force the equivalences
                # Right arrow
                # Left arrow
            else:
                if not self.fair:
                    self.generatePropagationReachableGUnfair(task, controllerStates, k - 1, debug)
                    # ReachG(n, j+1) &lt;--&gt; [1] 
                # [1] = [2] \lor [3]
                # [2] = (n, unfair) \land \AND_{n&#39;} [(n,n&#39;) --&gt; RG(n&#39;,j)]
                # [3] = \OR_{n&#39;} [(n, fair) \land (n,n&#39;) \land RG(n&#39;,j)]
                c1, v1 = self.get_num_cl_vars()
                start = timer()
                # Set variables (n, fair) and (n, unfair)
                self.setFairUnfairActions(task, controllerStates)
                # Force the equivalences for [2]
                # [(n,n&#39;) --&gt; RG(n&#39;,j)] &lt;-&gt; Repl(n,n&#39;,j)
                # Force the equivalences for [3]
                # [(n, fair) \land (n,n&#39;) \land RG(n&#39;,j)] &lt;-&gt; Repl3(n,n&#39;,j)
                # Right arrow
                # Left arrow
                else:
                    self.generatePropagationReachableGCyclic(task, controllerStates, k - 1, debug)
                    # ReachG(n, j+1) &lt;--&gt; \OR_{n&#39;} [(n,n&#39;) \land ReachG(n&#39;, j)]
                c1, v1 = self.get_num_cl_vars()
                start = timer()
                # Force the equivalences
                # Right arrow
                # Left arrow
</code></pre></div> <p>结果</p> <div class=highlight><pre><span></span><code>&gt;&gt;&gt; cnf.generateReachableGClauses(task, controllerStates, goalCState, k, debug)
23  0
22  0
-24 0
&#39;reachableG(ng,0)&#39;  0
&#39;reachableG(ng,1)&#39;  0
负&#39;reachableG(n0,0)&#39;     0
Generation: RG init              v 2             c : 3           0.009479
-24 21  0
-23 22  0
负&#39;reachableG(n0,0)&#39;     &#39;reachableG(n0,1)&#39;  0
负&#39;reachableG(ng,0)&#39; &#39;reachableG(ng,1)&#39;  0
Generation: RG compl             v 0             c : 2           0.012321
-25 -15 24  0
-24 25  0
15  25  0
-26 -16 23  0
-23 26  0
16  26  0
-21 25  0
-21 26  0
21  -25 -26 0
负&#39;YR1-n0-n0-0&#39;  负&#39;(n0,n0)&#39;  &#39;reachableG(n0,0)&#39;  0
负&#39;reachableG(n0,0)&#39;     &#39;YR1-n0-n0-0&#39;   0
&#39;(n0,n0)&#39;   &#39;YR1-n0-n0-0&#39;   0
负&#39;YR1-n0-ng-0&#39;  负&#39;(n0,ng)&#39;  &#39;reachableG(ng,0)&#39;  0
负&#39;reachableG(ng,0)&#39; &#39;YR1-n0-ng-0&#39;   0
&#39;(n0,ng)&#39;   &#39;YR1-n0-ng-0&#39;   0
负&#39;reachableG(n0,1)&#39; &#39;YR1-n0-n0-0&#39;   0
负&#39;reachableG(n0,1)&#39; &#39;YR1-n0-ng-0&#39;   0
&#39;reachableG(n0,1)&#39;  负&#39;YR1-n0-n0-0&#39;  负&#39;YR1-n0-ng-0&#39;  0
Generation: RG prop              v 2             c : 9           0.059131
</code></pre></div> <div class=highlight><pre><span></span><code>self.generateSymmetryBreaking(task, controllerStates, initialCState, goalCState, debug)
# (na, nb) --&gt; \OR_{i&lt;=a} (n_i, n_{b-1})
</code></pre></div> <p>结果</p> <div class=highlight><pre><span></span><code>&gt;&gt;&gt; cnf.generateSymmetryBreaking(task, controllerStates, initialCState, goalCState, debug)
Generation: Sym brk              v 0             c : 0           0.000004
</code></pre></div> <div class=highlight><pre><span></span><code>self.generateMutexGroupsClauses(task, controllerStates, debug)
</code></pre></div> <p>结果</p> <div class=highlight><pre><span></span><code>&gt;&gt;&gt; cnf.generateMutexGroupsClauses(task, controllerStates, debug)
-4  -1  0
-7  -2  0
负&#39;(var0=0)(n0)&#39; 负&#39;(var0=1)(n0)&#39; 0
负&#39;(var0=0)(ng)&#39; 负&#39;(var0=1)(ng)&#39;     0
Generation: Mutex                v 0             c : 2           0.010046
</code></pre></div> <h2 id=minisatcnfoutsat-temptx>通过调用minisat根据上cnf文件生成的outsat-temp.tx<a class=headerlink href=#minisatcnfoutsat-temptx title="Permanent link">&para;</a></h2> <p>land :<span class=arithmatex>\(\land\)</span></p> <p>lor: <span class=arithmatex>\(lor\)</span></p> <p>也就是说在命令行输入：</p> <div class=highlight><pre><span></span><code>&gt;./minisat formula-temp.txt outsat-temp.txt
[MINISAT]===================================
| Conflicts |     ORIGINAL     |              LEARNT              | Progress |
|           | Clauses Literals |   Limit Clauses Literals  Lit/Cl |          |
==============================================================================
|         0 |      21       69 |       7       0        0    -nan |  0.000 % |
==============================================================================
restarts              : 1
conflicts             : 0              (-nan /sec)
decisions             : 3              (inf /sec)
propagations          : 26             (inf /sec)
conflict literals     : 0              (-nan % deleted)
Memory used           : 13.79 MB
CPU time              : 0 s

SATISFIABLE
</code></pre></div> <p>根据上cnf文件生成的outsat-temp.txt</p> <div class=highlight><pre><span></span><code>SAT
-1 2 3 4 -5 -6 -7 -8 9 -10 -11 12 -13 -14 -15 16 -17 -18 19 20 21 22 23 -24 25 26 0
</code></pre></div> <p>也就是sat对应的公式结论 然后python读取这个满足cnf合取范式问题的可满足sat解，找到对应编号的公式翻译出来变成方案。</p> <p>根据下面的</p> <h3 id=_1>公式映射<a class=headerlink href=#_1 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code>&gt;&gt;&gt; print(cnf.mapNumberVariable)
{1: &#39;(var0=1)(n0)&#39;, 
2: &#39;(var0=1)(ng)&#39;, 
3: &#39;(n0,move(l1,l2))&#39;, 
4: &#39;(var0=0)(n0)&#39;, 
5: &#39;(n0,move(l2,l1))&#39;, 
6: &#39;(ng,move(l1,l2))&#39;, 
7: &#39;(var0=0)(ng)&#39;, 
8: &#39;(ng,move(l2,l1))&#39;, 
9: &#39;(n0,move)&#39;, 
10: &#39;(ng,move)&#39;, 
11: &#39;(n0,move,n0)&#39;, 
12: &#39;(n0,move,ng)&#39;, 
13: &#39;(ng,move,n0)&#39;, 
14: &#39;(ng,move,ng)&#39;, 
15: &#39;(n0,n0)&#39;, 
16: &#39;(n0,ng)&#39;, 
17: &#39;(ng,n0)&#39;, 
18: &#39;(ng,ng)&#39;, 
19: &#39;reachableI(n0)&#39;, 
20: &#39;reachableI(ng)&#39;, 
21: &#39;reachableG(n0,1)&#39;, 
22: &#39;reachableG(ng,1)&#39;, 
23: &#39;reachableG(ng,0)&#39;, 
24: &#39;reachableG(n0,0)&#39;, 
25: &#39;YR1-n0-n0-0&#39;, 
26: &#39;YR1-n0-ng-0&#39;}

&gt;&gt;&gt; print(cnf.mapVariableType)
{&#39;reachableG(ng,0)&#39;: 
5, &#39;(ng,move,n0)&#39;: 
3, &#39;(ng,move(l1,l2))&#39;: 
2, &#39;reachableI(n0)&#39;: 
4, &#39;(n0,move)&#39;: 
2, &#39;(ng,move(l2,l1))&#39;: 
2, &#39;(n0,move,ng)&#39;: 
3, &#39;(ng,move,ng)&#39;: 
3, &#39;reachableI(ng)&#39;: 
4, &#39;reachableG(n0,0)&#39;: 
5, &#39;(var0=0)(n0)&#39;: 
1, &#39;(ng,move)&#39;: 
2, &#39;(n0,n0)&#39;: 
7, &#39;reachableG(ng,1)&#39;: 
5, &#39;YR1-n0-n0-0&#39;: 
6, &#39;(ng,n0)&#39;: 
7, &#39;(var0=0)(ng)&#39;: 
1, &#39;YR1-n0-ng-0&#39;: 
6, &#39;(var0=1)(n0)&#39;: 
1, &#39;(n0,move(l2,l1))&#39;: 
2, &#39;(ng,ng)&#39;: 
7, &#39;(n0,ng)&#39;: 
7, &#39;(n0,move,n0)&#39;: 
3, &#39;(var0=1)(ng)&#39;: 
1, &#39;(n0,move(l1,l2))&#39;: 
2, &#39;reachableG(n0,1)&#39;: 5}

&gt;&gt;&gt; print(cnf.mapVariableNumber)
{&#39;reachableG(ng,0)&#39;: 
23, &#39;(ng,move,n0)&#39;: 
13, &#39;(ng,move(l1,l2))&#39;: 
6, &#39;reachableI(n0)&#39;: 
19, &#39;(n0,move)&#39;: 
9, &#39;(ng,move(l2,l1))&#39;: 
8, &#39;(n0,move,ng)&#39;: 
12, &#39;(ng,move,ng)&#39;: 
14, &#39;reachableI(ng)&#39;: 
20, &#39;reachableG(n0,0)&#39;: 
24, &#39;(var0=0)(n0)&#39;: 
4, &#39;(ng,move)&#39;: 
10, &#39;(n0,n0)&#39;: 
15, &#39;reachableG(ng,1)&#39;: 
22, &#39;YR1-n0-n0-0&#39;: 
25, &#39;(ng,n0)&#39;: 
17, &#39;(var0=0)(ng)&#39;: 
7, &#39;YR1-n0-ng-0&#39;: 
26, &#39;(var0=1)(n0)&#39;: 
1, &#39;(n0,move(l2,l1))&#39;: 
5, &#39;(ng,ng)&#39;: 
18, &#39;(n0,ng)&#39;: 
16, &#39;(n0,move,n0)&#39;: 
11, &#39;(var0=1)(ng)&#39;: 
2, &#39;(n0,move(l1,l2))&#39;: 
3, &#39;reachableG(n0,1)&#39;: 21}
</code></pre></div> <div class=highlight><pre><span></span><code>SAT
-1 2 3 4 -5 -6 -7 -8 9 -10 -11 12 -13 -14 -15 16 -17 -18 19 20 21 22 23 -24 25 26 0
</code></pre></div> <p>是这些cnf合取范式起来得到的结果</p> <div class=highlight><pre><span></span><code>2: &#39;(var0=1)(ng)&#39;, 
3: &#39;(n0,move(l1,l2))&#39;, 
4: &#39;(var0=0)(n0)&#39;, 
9: &#39;(n0,move)&#39;, 
12: &#39;(n0,move,ng)&#39;, 
16: &#39;(n0,ng)&#39;, 
19: &#39;reachableI(n0)&#39;, 
20: &#39;reachableI(ng)&#39;, 
21: &#39;reachableG(n0,1)&#39;, 
22: &#39;reachableG(ng,1)&#39;, 
23: &#39;reachableG(ng,0)&#39;, 
25: &#39;YR1-n0-n0-0&#39;, 
26: &#39;YR1-n0-ng-0&#39;}
</code></pre></div> <div class=highlight><pre><span></span><code>===================
===================
Controller -- CS = Controller State
===================
===================
Atom (CS)
___________________
----------
Atom person-at(l1) (n0)
----------
Atom person-at(l2) (ng)
===================
===================
(CS, Action with arguments)
___________________
(n0,move(l1,l2))
(n0,move)
===================
===================
(CS, Action name, CS)
___________________
(n0,move,ng)
===================
(CS, CS)
___________________
(n0,ng)
===================
</code></pre></div> <h2 id=_2>最终结果：<a class=headerlink href=#_2 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code>==================================[MINISAT]===================================
| Conflicts |     ORIGINAL     |              LEARNT              | Progress |
|           | Clauses Literals |   Limit Clauses Literals  Lit/Cl |          |
==============================================================================
|         0 |      21       69 |       7       0        0    -nan |  0.000 % |
==============================================================================
restarts              : 1
conflicts             : 0              (-nan /sec)
decisions             : 3              (inf /sec)
propagations          : 26             (inf /sec)
conflict literals     : 0              (-nan % deleted)
Memory used           : 13.79 MB
CPU time              : 0 s

SATISFIABLE
Setting atoms
# Atoms: 2
Setting initial
Setting goal
Setting actions
# Actions: 2
    Setting other actions
(0, &#39;/&#39;, 2)
    Setting action card
Setting mutexes
Setting relevant actions
Setting splitting
Setting compatible actions
(0, &#39;/&#39;, 2)
2.88486480713e-05
=================================================
Trying with 2 states
Looking for strong plans: True
Fair actions: True
# Atoms: 2
# Actions: 2
SAT formula generation time = 0.000351
# Clauses = 70
# Variables = 26
Creating formula...
Done creating formula. Calling solver...
SAT solver called with 4096 MB and 3599 seconds
Done solver. Round time: 0.015620
Cumulated solver time: 0.015620

...

Solved with 2 states
Elapsed total time (s): 0.115060
Elapsed solver time (s): 0.015620
Elapsed solver time (s): [0.015619993209838867]
Looking for strong plans: True
Fair actions: True
</code></pre></div> <h1 id=stupid-road-demo-run-in-ipythonjupyter>我的stupid road demo run in Ipython/Jupyter<a class=headerlink href=#stupid-road-demo-run-in-ipythonjupyter title="Permanent link">&para;</a></h1> <h2 id=mainpy>main.py<a class=headerlink href=#mainpy title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code>from CNF import CNF
import os
import sys
from myTask import MyTask
from timeit import default_timer as timer
import time
import argparse
from parser import Parser 

def clean_and_exit(n1, n2, n3, n4, n5, msg):
    print(msg)
    os.system(&#39;rm %s %s %s %s %s&#39; % (n1, n2, n3, n4, n5))
    exit()

def generateControllerStates(i):
    controllerStates = [&#39;n0&#39;]
    for j in range(i):
        controllerStates.append(&#39;n&#39; + str(j + 1))
    controllerStates.append(&#39;ng&#39;)
    return controllerStates
</code></pre></div> <h2 id=args>替换args输入参数字典，直接输入我想要的字典，包括传进去的数值参数<a class=headerlink href=#args title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code># my stuppid example:
params={&#39;time_limit&#39;: 3600, &#39;inc&#39;: 1, &#39;path_domain&#39;: &#39;../mystupidroad/domain.pddl&#39;, &#39;gen_info&#39;: 0, &#39;policy&#39;: 1, &#39;mem_limit&#39;: 4096, &#39;strong&#39;: 1, &#39;path_instance&#39;: &#39;../mystupidroad/stupid.pddl&#39;, &#39;name_temp&#39;: &#39;temp&#39;}

#print params dictionary
#print(params)
#raw_input()
# Run code  below in ipython
# params={&#39;time_limit&#39;: 3600, &#39;inc&#39;: 1, &#39;path_domain&#39;: &#39;../F-domains/islands/domain.pddl&#39;, &#39;gen_info&#39;: 0, &#39;policy&#39;: 1, &#39;mem_limit&#39;: 4096, &#39;strong&#39;: 0, &#39;path_instance&#39;: &#39;../F-domains/islands/p03.pddl&#39;, &#39;name_temp&#39;: &#39;temp&#39;}

# my stuppid example:
#params={&#39;time_limit&#39;: 3600, &#39;inc&#39;: 1, &#39;path_domain&#39;: &#39;../mystupidroad/domain.pddl&#39;, &#39;gen_info&#39;: 0, &#39;policy&#39;: 1, &#39;mem_limit&#39;: 4096, &#39;strong&#39;: 1, &#39;path_instance&#39;: &#39;../mystupidroad/stupid.pddl&#39;, &#39;name_temp&#39;: &#39;temp&#39;}
</code></pre></div> <div class=highlight><pre><span></span><code>time_start = timer()
time_limit = params[&#39;time_limit&#39;] #3600 default 
time_buffer = 2
mem_limit = params[&#39;mem_limit&#39;] #4096 default 
p = Parser()
p.set_domain(params[&#39;path_domain&#39;]) #path_domain 
p.set_problem(params[&#39;path_instance&#39;]) #path_instance 
name_formula_file = &#39;formula-&#39; + params[&#39;name_temp&#39;] + &#39;.txt&#39; 

#name_formula_file formula-temp.txt   formula-temp.txtheader       cnf diff In  ---&gt;   p cnf 656 7458 --- &gt; p cnf 1 1

name_formula_file_extra = &#39;formula-extra-&#39; + params[&#39;name_temp&#39;] + &#39;.txt&#39; #name_formula_file_extra :formula-extra-temp.txt      blank
name_output_satsolver = &#39;outsat-&#39; + params[&#39;name_temp&#39;] + &#39;.txt&#39; #name_output_satsolver : outsat-temp.txt
name_sas_file = &#39;outputtrans-&#39; + params[&#39;name_temp&#39;] + &#39;.sas&#39; #name_sas_file   outputtrans-temp.sas

#time_limit 3600 default 
#mem_limit 4096 default 
#path_domain 
#path_instance 

# params={&#39;time_limit&#39;: 3600, &#39;inc&#39;: 1, &#39;path_domain&#39;: &#39;../F-domains/islands/domain.pddl&#39;, &#39;gen_info&#39;: 0, &#39;policy&#39;: 1, &#39;mem_limit&#39;: 4096, &#39;strong&#39;: 0, &#39;path_instance&#39;: &#39;../F-domains/islands/p03.pddl&#39;, &#39;name_temp&#39;: &#39;temp&#39;}

# my stuppid example:
#params={&#39;time_limit&#39;: 3600, &#39;inc&#39;: 1, &#39;path_domain&#39;: &#39;../mystupidroad/domain.pddl&#39;, &#39;gen_info&#39;: 0, &#39;policy&#39;: 1, &#39;mem_limit&#39;: 4096, &#39;strong&#39;: 0, &#39;path_instance&#39;: &#39;../mystupidroad/stupid.pddl&#39;, &#39;name_temp&#39;: &#39;temp&#39;}


# middle Files to be clean and exit
#name_formula_file :formula-temp.txt   formula-temp.txtheader       cnf  diff in ---&gt; p cnf 656 7458 --- &gt; p cnf 1 1
#name_formula_file_extra :formula-extra-temp.txt      blank
#name_output_satsolver : outsat-temp.txt
#name_sas_file ;outputtrans-temp.sas


p.generate_file(name_sas_file)
</code></pre></div> <p>相当于命令行执行：</p> <div class=highlight><pre><span></span><code>command = &#39;python translate/translate.py &#39; + str(time_limit) + &#39; &#39; + self.domain + &#39; &#39; + self.problem + &#39; &#39; + sas_file_name + &#39; | grep &quot;noprint&quot;&#39;
</code></pre></div> <h2 id=domainpddltranslatepysas>使用domain文件和问题描述文件pddl通过translate.py生成翻译后的sas文件<a class=headerlink href=#domainpddltranslatepysas title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code>begin_version
3
end_version
begin_metric
0
end_metric
1
begin_variable
var0
-1
2
Atom person-at(l1)
Atom person-at(l2)
end_variable
1
begin_mutex_group
2
0 0
0 1
end_mutex_group
begin_state
0
end_state
begin_goal
1
0 1
end_goal
2
begin_operator有多少个操作全部都写在这里，比如L3有4个操作
move l1 l2
0
1
0 0 0 1
0
end_operator
begin_operator
move l2 l1
0
1
0 0 1 0
0
end_operator
0这行固定的
</code></pre></div> <p>接着</p> <div class=highlight><pre><span></span><code>p.generate_task(name_sas_file) #读取sas文件，保存数据
&gt;&gt;&gt; my_task = p.translate_to_atomic() #存进my_task类的实例对象my_task中
Setting atoms
# Atoms: 3
Setting initial
Setting goal
Setting actions
# Actions: 4
        Setting other actions
(0, &#39;/&#39;, 4)
        Setting action card
Setting mutexes
Setting relevant actions
Setting splitting
Setting compatible actions
(0, &#39;/&#39;, 4)
0.00387597084045
</code></pre></div> <h2 id=parsermytask>在Parser类的方法中翻译成，保存成mytask类的数据：<a class=headerlink href=#parsermytask title="Permanent link">&para;</a></h2> <p>parser.py中p.translate_to_atomic</p> <div class=highlight><pre><span></span><code>    task = MyTask()
    debug = False#这个应该是开发的时候方便调试可以设置True
    print(&#39;Setting atoms&#39;)#原子命题
    task.set_atoms(self.get_atoms(), debug)
    print(&#39;Setting initial&#39;)#初态
    task.set_initial(self.get_initial_atomic(), debug)
    print(&#39;Setting goal&#39;)#终态
    task.set_goal(self.get_goal_atomic(), debug)
    print(&#39;Setting actions&#39;)#设定动作
    task.set_actions_atomic(self.get_actions_atomic(), debug)
    print(&#39;Setting mutexes&#39;)#设定互斥量？
    task.set_mutex_groups(self.get_mutex_groups_atomic(), debug)
    print(&#39;Setting relevant actions&#39;)#设置相关动作
    task.set_relevant_actions(debug)
    print(&#39;Setting splitting&#39;)#分裂
    task.initialize_splitting(debug)
    start = timer()
    print(&#39;Setting compatible actions&#39;)#设置相容可以并存的动作
    task.create_compatible_actions(debug)
    print(timer() - start)
    return task
</code></pre></div> <p>而查看my_task类中的局部变量</p> <div class=highlight><pre><span></span><code>class MyTask():
    def __init__(self):
        self.atoms = None # Set
        self.initial = None # Set of atoms
        self.goal = None # Set of atoms
        self.actions = None # Dictionary, name --&gt; [precs, adds, dels]
        self.action_nondet = {} # name --&gt; list other actions
        self.action_cardinality = {} # name --&gt; number
        self.mutex_groups = None # list of list; each sub-list has atoms belonging to the same mutex group
        self.compatible_actions = {} # action name --&gt; set of compatible actions
        self.mutex_groups_set = [] # list of sets of mutex groups
        self.relevant_actions_atom = {} # dictionary: atom --&gt; relevant actions
        self.relevant_actions_atom_aname = {} # dictionary: (atom, a_name) --&gt; relevant actions
        self.action_names = None # set
        self.other_actions_name = {} # Dictionary name --&gt; list of other actions
        self.action_name_to_actions = {} # action_name --&gt; list of actions
        ......
    def is_fair(self):
        for a in self.actions:
            if &#39;_unfair_&#39; in a:
                return False
        return True
        ......
</code></pre></div> <p>回到main.py</p> <div class=highlight><pre><span></span><code>fair = my_task.is_fair()#判断True/False,demo p03 is True,本题设置为True

print_policy = True
if params[&#39;policy&#39;] == 0:
    print_policy = False

strong = True
if params[&#39;strong&#39;] == 0:
    strong = False

show_gen_info = True
if params[&#39;gen_info&#39;] == 0:
    show_gen_info = False
#根据输入参数决定显示结果

cnf = CNF(name_formula_file, name_formula_file_extra, fair, strong)
#重点，根据公式文件formula-temp.txt这时候是空白的，formula-extra-temp此时空白，使用fair，strong取值决定策略
</code></pre></div> <h2 id=_3>接下来这个大循环就是高潮部分：注意留意重点：<a class=headerlink href=#_3 title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code>solver_time = []
for i in range(1000):
    cnf = CNF(name_formula_file, name_formula_file_extra, fair, strong)#文件formula-temp.txt这时候是空白的，formula-extra-temp此时空白，仅仅是传入地址方便最终结果存入数据
    ......
    cnf.reset()
      start_g = timer()
    cnf.generate_clauses(my_task, &#39;n0&#39;, &#39;ng&#39;, controllerStates, len(controllerStates), p, show_gen_info)#生成子句Clauses和写入cnf文件合取范式的核心代码!!!每次循环k追加nk,比如例子中controllerStates = [&#39;n0&#39;, &#39;ng&#39;]
    ......
    command = &#39;./minisat %s %s&#39; % (name_formula_file, name_output_satsolver)#调用minisat
    ......
    result = cnf.parseOutput(name_output_satsolver, controllerStates, p, print_policy)#读取文件name_output_satsolver : outsat-temp.txt输出结果
    ......
</code></pre></div> <p>因为大循环对打断，所以我在大循环区域上下加分割线</p> <hr> <div class=highlight><pre><span></span><code>solver_time = []
for i in range(1000):
    if timer() - time_start &gt; time_limit - time_buffer:
        clean_and_exit(name_formula_file, name_output_satsolver, name_sas_file, name_formula_file_extra, name_final, &#39;-&gt; OUT OF TIME&#39;)
    controllerStates = generateControllerStates(i * params[&#39;inc&#39;])
    print(&#39;=================================================&#39;)
    print(&#39;Trying with %i states&#39; % len(controllerStates))
    print(&#39;Looking for strong plans: %s&#39; % str(strong))
    print(&#39;Fair actions: %s&#39; % str(fair))
    print(&#39;# Atoms: %i&#39; % len(my_task.get_atoms()))
    print(&#39;# Actions: %i&#39; % len(my_task.get_actions()))
&#39;&#39;&#39;输出
第一遍
=================================================
Trying with 2 states
Looking for strong plans: True
Fair actions: True
# Atoms: 3
# Actions: 4
第二遍3 states有答案
=================================================
Trying with 3 states
Looking for strong plans: True
Fair actions: True
# Atoms: 3
# Actions: 4
&#39;&#39;&#39;
    cnf.reset()
    start_g = timer()
    cnf.generate_clauses(my_task, &#39;n0&#39;, &#39;ng&#39;, controllerStates, len(controllerStates), p, show_gen_info)
    print(&#39;SAT formula generation time = %f&#39; % (timer() - start_g))
    print(&#39;# Clauses = %i&#39; % cnf.getNumberClauses())
    print(&#39;# Variables = %i&#39; % cnf.getNumberVariables())
&#39;&#39;&#39;输出
第一遍
SAT formula generation time = 0.000691
# Clauses = 99
# Variables = 32
第二遍
SAT formula generation time = 0.001249
# Clauses = 234
# Variables = 66
&#39;&#39;&#39;
    if timer() - time_start &gt; time_limit - time_buffer:
        clean_and_exit(name_formula_file, name_output_satsolver, name_sas_file, name_formula_file_extra, name_final, &#39;-&gt; OUT OF TIME&#39;)
    print(&#39;Creating formula...&#39;)
    name_final = cnf.generateInputSat(name_formula_file)
    print(&#39;Done creating formula. Calling solver...&#39;)
&#39;&#39;&#39;输出
第一遍
Creating formula...
Done creating formula. Calling solver...
第二遍
Creating formula...
Done creating formula. Calling solver...
&#39;&#39;&#39;
    start_solv = timer()
    time_for_sat = int(time_limit - (timer() - time_start))
    if time_for_sat &lt; time_buffer:
        clean_and_exit(name_formula_file, name_output_satsolver, name_sas_file, name_formula_file_extra, name_final, &#39;-&gt; OUT OF TIME&#39;)
    command = &#39;./minisat %s %s&#39; % (name_formula_file, name_output_satsolver)
    # command = &#39;/path/to/SATsolver/minisat -mem-lim=%i -cpu-lim=%i %s %s&#39; % (mem_limit, time_for_sat, name_formula_file, name_output_satsolver)
    print(&#39;SAT solver called with %i MB and %i seconds&#39; % (mem_limit, time_for_sat))
&#39;&#39;&#39;输出
第一遍
SAT solver called with 4096 MB and 1287 seconds
第二遍
SAT solver called with 4096 MB and 1286 seconds
&#39;&#39;&#39;
    os.system(command)
&#39;&#39;&#39;调用minisat求解得到输出：
第一遍
restarts              : 0
conflicts             : 0              (0 /sec)
decisions             : 0              (0 /sec)
propagations          : 19             (1216 /sec)
conflict literals     : 0              (-nan % deleted)
Memory used           : 13.79 MB
CPU time              : 0.015625 s

UNSATISFIABLE第一遍2 states没找到答案
第二遍找到答案
==================================[MINISAT]===================================
| Conflicts |     ORIGINAL     |              LEARNT              | Progress |
|           | Clauses Literals |   Limit Clauses Literals  Lit/Cl |          |
==============================================================================
|         0 |      52      240 |      17       0        0    -nan |  0.000 % |
==============================================================================
restarts              : 1
conflicts             : 0              (-nan /sec)
decisions             : 3              (inf /sec)
propagations          : 66             (inf /sec)
conflict literals     : 0              (-nan % deleted)
Memory used           : 13.79 MB
CPU time              : 0 s

SATISFIABLE第二遍3 states满足
&#39;&#39;&#39;
    end_solv = timer()
    solver_time.append(end_solv - start_solv)
    print(&#39;Done solver. Round time: %f&#39; % (end_solv - start_solv))
    print(&#39;Cumulated solver time: %f&#39; % sum(solver_time))
&#39;&#39;&#39;输出
第一遍
5120
Done solver. Round time: 0.164243
Cumulated solver time: 0.164243
第二遍

&#39;&#39;&#39;
    result = cnf.parseOutput(name_output_satsolver, controllerStates, p, print_policy)
    if result is None:
        clean_and_exit(name_formula_file, name_output_satsolver, name_sas_file, name_formula_file_extra, name_final, &#39;-&gt; OUT OF TIME/MEM&#39;)#超出限定的内存和时间也找不到答案，不知道有没有解
    if result:
        break
    print(&#39;UNSATISFIABLE&#39;)#无解
&#39;&#39;&#39;输出
第一遍2 states没结果UNSATISFIABLE
第二遍
2560
Done solver. Round time: 0.208893
Cumulated solver time: 0.373136
和第一次不同的是这次有解，输出答案策略轨迹序列。
这部分是根据CNF.py中的def parseOutput(self, nameFile, controllerStates, parser, print_policy = False):的输出结果 
===================
===================
Controller -- CS = Controller State
===================
===================
Atom (CS)
___________________
----------
Atom person-at(l1) (n0)
----------
Atom person-at(l2) (n1)
----------
Atom person-at(l3) (ng)
===================
===================
(CS, Action with arguments)
___________________
(n0,move)
(n0,move(l1,l2))
(n1,move(l2,l3))
(n1,move)
===================
===================
(CS, Action name, CS)
___________________
(n0,move,n1)
(n1,move,ng)
===================
(CS, CS)
___________________
(n1,ng)
(n0,n1)
===================
Solved with 3 states
&#39;&#39;&#39;
</code></pre></div> <p>核心循环到此结束</p> <hr> <p>main.py快结束了</p> <div class=highlight><pre><span></span><code>print(&#39;Elapsed total time (s): %f&#39; % (timer() - time_start))
print(&#39;Elapsed solver time (s): %f&#39; % sum(solver_time))
print(&#39;Elapsed solver time (s): %s&#39; % str(solver_time))
print(&#39;Looking for strong plans: %s&#39; % str(strong))
print(&#39;Fair actions: %s&#39; % str(fair))
clean_and_exit(name_formula_file, name_output_satsolver, name_sas_file, name_formula_file_extra, name_final, &#39;Done&#39;)#清理中间文件
</code></pre></div></div> <footer> <div class=footer-buttons> <div class=previous><a href=../QA_FOND/ title=QA_FOND><span>Previous</span></a></div> <div class=next><a href=../QNP/ title=QNP><span>Next</span></a></div> </div> <div class=footer-note> <p> Built with <a href=http://www.mkdocs.org>MkDocs</a> using <a href=https://github.com/daizutabi/mkdocs-ivory>Ivory theme</a>. </p> </div> </footer> </div> </main> </div> <script>var base_url = '../../../..';</script> <script src=../../../../js/theme.js></script> <script src=../../../../js/umlconvert.js></script> <script src=../../../../js/sequence-loader.js></script> <script src=https://unpkg.com/mermaid/dist/mermaid.min.js></script> <script src=https://cdnjs.cloudflare.com/ajax/libs/raphael/2.3.0/raphael.min.js></script> <script src=https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.12.0/underscore-min.js></script> <script src=https://cdnjs.cloudflare.com/ajax/libs/js-sequence-diagrams/1.0.6/sequence-diagram-min.js></script> <script src=https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.6.5/flowchart.min.js></script> <script src=../../../../search/main.js></script> </body> </html>